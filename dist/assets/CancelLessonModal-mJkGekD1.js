import{j as e,e as C,f as y}from"./supabase-vendor-zrCfvSZu.js";import{r as d,u as w}from"./react-vendor-C2tQq_zP.js";import{B as o,s as x}from"./index-CcM7G_HG.js";import{D as f,i as D,a as j,b as p,c as v,d as g}from"./dialog-C0xQx6hb.js";import{ac as h,a8 as E,D as u,L as k}from"./ui-vendor-D-xBSbyO.js";import{L as N}from"./label-BuoQyU_D.js";import{T}from"./textarea-FnepGMth.js";function P({userType:c}){const[m,r]=d.useState(!1),[s,n]=d.useState(!1),[i,t]=d.useState(!1),a=w(),b=async()=>{if(s){t(!0);try{const{error:l}=await x.auth.signOut();if(l)throw l;u.success("Conta desativada",{description:"Sua conta foi desativada com sucesso. Seus dados serão excluídos em até 30 dias."}),a("/")}catch(l){console.error("Error deleting account:",l),u.error("Erro ao excluir conta")}finally{t(!1),r(!1)}}};return e.jsxs("div",{className:"mt-8 pt-8 border-t",children:[e.jsxs("h3",{className:"text-lg font-semibold text-destructive flex items-center gap-2 mb-4",children:[e.jsx(h,{className:"h-5 w-5"}),"Zona de Perigo"]}),e.jsxs("div",{className:"bg-destructive/5 border border-destructive/20 rounded-lg p-4 flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-destructive",children:"Excluir Conta"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:c==="student"?"Ao excluir sua conta, todo o seu histórico de aulas e mensagens será perdido permanentemente.":"Ao excluir sua conta, seu perfil não aparecerá mais nas buscas e todas as suas informações serão removidas."})]}),e.jsxs(f,{open:m,onOpenChange:r,children:[e.jsx(D,{asChild:!0,children:e.jsxs(o,{variant:"destructive",className:"shrink-0",children:[e.jsx(E,{className:"h-4 w-4 mr-2"}),"Excluir Conta"]})}),e.jsxs(j,{className:"sm:max-w-[425px]",children:[e.jsxs(p,{children:[e.jsxs(v,{className:"text-destructive flex items-center gap-2",children:[e.jsx(h,{className:"h-5 w-5"}),"Excluir Conta"]}),e.jsx(g,{className:"pt-2",children:e.jsx("p",{className:"mb-4",children:"ATENÇÃO! Todos os seus dados (histórico, mensagens, contatos...) serão excluídos definitivamente e de maneira irreversível."})})]}),e.jsx("div",{className:"py-4",children:e.jsxs("div",{className:"bg-secondary/50 p-4 rounded-lg flex items-center gap-3 border border-border",children:[e.jsx("div",{className:`w-5 h-5 rounded-full border cursor-pointer flex items-center justify-center transition-colors ${s?"bg-destructive border-destructive":"border-input bg-background"}`,onClick:()=>n(!s),children:s&&e.jsx("div",{className:"w-2.5 h-2.5 bg-white rounded-full"})}),e.jsx(N,{htmlFor:"delete-confirm",className:"font-normal cursor-pointer select-none",onClick:()=>n(!s),children:"Estou ciente e quero excluir minha conta"})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(o,{variant:"outline",onClick:()=>r(!1),children:"Cancelar"}),e.jsx(o,{variant:"destructive",onClick:b,disabled:!s||i,children:i?"Processando...":"Excluir Conta"})]})]})]})]})]})}function Q({lessonId:c,open:m,onOpenChange:r}){const[s,n]=d.useState(""),i=C(),t=y({mutationFn:async()=>{const{error:a}=await x.from("lessons").update({status:"cancelled"}).eq("id",c);if(a)throw a;await x.functions.invoke("send-cancellation-email",{body:{lessonId:c,reason:s}})},onSuccess:()=>{i.invalidateQueries({queryKey:["student-lessons"]}),i.invalidateQueries({queryKey:["instructor-lessons"]}),u.success("Aula cancelada com sucesso"),r(!1),n("")},onError:a=>{u.error(a.message||"Erro ao cancelar aula")}});return e.jsx(f,{open:m,onOpenChange:r,children:e.jsxs(j,{className:"sm:max-w-md",children:[e.jsxs(p,{children:[e.jsxs(v,{className:"flex items-center gap-2 text-destructive",children:[e.jsx(h,{className:"h-5 w-5"}),"Cancelar Aula"]}),e.jsx(g,{children:"Tem certeza que deseja cancelar esta aula? O instrutor será notificado por email."})]}),e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(N,{htmlFor:"reason",children:"Motivo do cancelamento (opcional)"}),e.jsx(T,{id:"reason",placeholder:"Explique o motivo do cancelamento...",value:s,onChange:a=>n(a.target.value),rows:3})]})}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(o,{variant:"outline",onClick:()=>r(!1),children:"Voltar"}),e.jsx(o,{variant:"destructive",onClick:()=>t.mutate(),disabled:t.isPending,children:t.isPending?e.jsxs(e.Fragment,{children:[e.jsx(k,{className:"mr-2 h-4 w-4 animate-spin"}),"Cancelando..."]}):"Confirmar Cancelamento"})]})]})})}export{Q as C,P as D};
