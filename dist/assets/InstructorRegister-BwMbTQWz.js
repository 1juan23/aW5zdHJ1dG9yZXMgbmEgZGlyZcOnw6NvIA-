import{j as e}from"./supabase-vendor-zrCfvSZu.js";import{u as te,H as ie,C as oe,a as le,b as ne,d as ce,e as de,B as S,F as me,s as N}from"./index-CcM7G_HG.js";import{I as x}from"./input-CCzeZ9h-.js";import{L as l}from"./label-BuoQyU_D.js";import{T as ue}from"./textarea-FnepGMth.js";import{S as U,a as V,b as $,c as D,d as j}from"./select-481qhC-1.js";import{r as h,u as xe,H as he,L as P}from"./react-vendor-C2tQq_zP.js";import{A as z,a as O,b as H}from"./avatar-DeTSaY0_.js";import{o as pe,a as p,Z as fe,g as ge}from"./validations-BW1-a5ag.js";import{u as je,E as ve}from"./EmailSecurityBadge-Cq55aYub.js";import{g as Ne,n as _,U as F,P as be,j as ye,x as G,E as we,y as Ee,k as Ce,N as Se,O as Pe,L as Fe,A as Ae}from"./ui-vendor-D-xBSbyO.js";import"./index-BdQq_4o_.js";import"./index-CVM1siHy.js";const A=[{id:1,title:"Dados pessoais"},{id:2,title:"Profissional"},{id:3,title:"Finalizar"}],Te=["Iniciante","Medo de dirigir","Primeira habilitação","Reciclagem","Habilitados","Baliza","Estrada","Defensiva"],ke=["AC","AL","AP","AM","BA","CE","DF","ES","GO","MA","MT","MS","MG","PA","PB","PR","PE","PI","RJ","RN","RS","RO","RR","SC","SP","SE","TO"];function Ge(){const[r,T]=h.useState(1),[v,Z]=h.useState(!1),[b,k]=h.useState(!1),[y,J]=h.useState(null),[w,Q]=h.useState(null),[Re,f]=h.useState({}),R=h.useRef(null),W=xe(),{toast:u}=te(),{validateEmail:K,isValidating:I,validationResult:i,isBlocked:X,clearValidation:Y}=je(),[s,o]=h.useState({name:"",email:"",phone:"",password:"",confirmPassword:"",city:"",state:"",neighborhoods:"",experience:"",specialties:[],bio:"",price:"",terms:!1}),B=a=>{var t;f({});try{if(a===1){if((i==null?void 0:i.status)==="BLOQUEADO")return f({email:"Este email foi bloqueado por motivos de segurança"}),u({title:"Email bloqueado",description:i.motivos.join(". "),variant:"destructive"}),!1;if(i&&i.score_risco>50)return f({email:"Este email apresenta alto risco e não pode ser utilizado"}),u({title:"Email de alto risco",description:`Score de risco: ${i.score_risco}/100. ${i.motivos.join(". ")}`,variant:"destructive"}),!1;if((t=i==null?void 0:i.reputacao)!=null&&t.virustotal&&i.reputacao.virustotal!=="limpo"&&i.reputacao.virustotal!=="sem_dados")return f({email:"Este email foi detectado como malicioso pelo VirusTotal"}),u({title:"Email malicioso detectado",description:`VirusTotal: ${i.reputacao.virustotal}`,variant:"destructive"}),!1;pe({name:p().trim().min(2,"Nome deve ter pelo menos 2 caracteres").max(100,"Nome muito longo"),email:p().trim().min(1,"Email é obrigatório").email("Email inválido").max(255,"Email muito longo"),phone:p().trim().min(10,"Telefone deve ter pelo menos 10 dígitos").max(20,"Telefone muito longo"),password:p().min(8,"Senha deve ter pelo menos 8 caracteres").regex(/[A-Z]/,"Senha deve conter pelo menos uma letra maiúscula").regex(/[a-z]/,"Senha deve conter pelo menos uma letra minúscula").regex(/[0-9]/,"Senha deve conter pelo menos um número"),confirmPassword:p().min(1,"Confirme sua senha"),city:p().trim().min(2,"Cidade deve ter pelo menos 2 caracteres").max(100,"Nome da cidade muito longo"),state:p().min(2,"Selecione um estado")}).refine(c=>c.password===c.confirmPassword,{message:"As senhas não coincidem",path:["confirmPassword"]}).parse({name:s.name,email:s.email,phone:s.phone,password:s.password,confirmPassword:s.confirmPassword,city:s.city,state:s.state})}else if(a===3&&!s.terms)return f({terms:"Aceite os termos para continuar"}),u({title:"Erro de validação",description:"Aceite os termos para continuar",variant:"destructive"}),!1;return!0}catch(n){if(n instanceof fe){const c={};n.errors.forEach(g=>{g.path[0]&&(c[g.path[0].toString()]=g.message)}),f(c),u({title:"Erro de validação",description:ge(n),variant:"destructive"})}return!1}},ee=async a=>{var t,n,c,g;if(a.preventDefault(),r<3){B(r)&&T(r+1);return}if(B(3)){k(!0);try{const{data:d,error:m}=await N.auth.signUp({email:s.email,password:s.password,options:{emailRedirectTo:`${window.location.origin}/`,data:{name:s.name,phone:s.phone,user_type:"instructor"}}});if(m)throw console.error("Auth error:",m),m;if(!d.user)throw new Error("Erro ao criar conta. Tente novamente.");await new Promise(C=>setTimeout(C,500));let L=null;if(y){const C=y.name.split(".").pop(),q=`${d.user.id}/avatar.${C}`,{error:M}=await N.storage.from("avatars").upload(q,y,{upsert:!0});if(M)console.error("Avatar upload error:",M);else{const{data:re}=N.storage.from("avatars").getPublicUrl(q);L=re.publicUrl}}const{error:E}=await N.from("instructors").insert({user_id:d.user.id,name:s.name,email:s.email,phone:s.phone,city:s.city,state:s.state,neighborhoods:s.neighborhoods,experience:s.experience,specialties:s.specialties,bio:s.bio,price:s.price?parseFloat(s.price):null,avatar_url:L});if(E)throw console.error("Instructor profile error:",E),E;u({title:"Cadastro realizado!",description:"Sua conta foi criada com sucesso. Aguarde a aprovação do seu perfil."}),W("/instrutor/login")}catch(d){let m="Ocorreu um erro ao criar sua conta. Tente novamente.";(t=d.message)!=null&&t.includes("already registered")?m="Este email já está cadastrado. Faça login ou use outro email.":(n=d.message)!=null&&n.includes("Invalid email")?m="Email inválido. Verifique o endereço informado.":(c=d.message)!=null&&c.includes("row-level security")||d.code==="42501"?m="Erro de permissão. Por favor, tente novamente em alguns instantes.":(g=d.message)!=null&&g.includes("duplicate key")?m="Este email já está cadastrado como instrutor.":d.message&&(m=d.message),u({title:"Erro no cadastro",description:m,variant:"destructive"})}finally{k(!1)}}},se=a=>{o(t=>({...t,specialties:t.specialties.includes(a)?t.specialties.filter(n=>n!==a):[...t.specialties,a]}))},ae=a=>{var n;const t=(n=a.target.files)==null?void 0:n[0];if(t){if(t.size>2*1024*1024){u({title:"Arquivo muito grande",description:"A imagem deve ter no máximo 2MB.",variant:"destructive"});return}J(t);const c=new FileReader;c.onloadend=()=>{Q(c.result)},c.readAsDataURL(t)}};return e.jsxs(e.Fragment,{children:[e.jsxs(he,{children:[e.jsx("title",{children:"Cadastro de Instrutor | Instrutores na Direção"}),e.jsx("meta",{name:"description",content:"Cadastre-se como instrutor de direção e aumente sua visibilidade. Conquiste mais alunos através da nossa plataforma."})]}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(ie,{}),e.jsx("main",{className:"flex-1 py-12 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-2xl",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 rounded-2xl bg-primary text-primary-foreground mb-4",children:e.jsx(Ne,{className:"h-8 w-8"})}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Cadastro de Instrutor"}),e.jsx("p",{className:"text-muted-foreground mt-2",children:"Preencha seus dados para criar seu perfil na plataforma"})]}),e.jsx("div",{className:"flex items-center justify-center mb-8",children:A.map((a,t)=>e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full font-medium text-sm transition-colors ${r>=a.id?"bg-primary text-primary-foreground":"bg-secondary text-muted-foreground"}`,children:r>a.id?e.jsx(_,{className:"h-5 w-5"}):a.id}),e.jsx("span",{className:`ml-2 text-sm hidden sm:inline ${r>=a.id?"text-foreground font-medium":"text-muted-foreground"}`,children:a.title}),t<A.length-1&&e.jsx("div",{className:`w-12 h-0.5 mx-4 ${r>a.id?"bg-primary":"bg-secondary"}`})]},a.id))}),e.jsxs(oe,{variant:"elevated",children:[e.jsxs(le,{children:[e.jsx(ne,{children:A[r-1].title}),e.jsxs(ce,{children:[r===1&&"Informações básicas para criar sua conta",r===2&&"Conte-nos sobre sua experiência profissional",r===3&&"Revise seus dados e finalize o cadastro"]})]}),e.jsxs(de,{children:[e.jsxs("form",{onSubmit:ee,className:"space-y-6",children:[r===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"Nome completo"}),e.jsxs("div",{className:"relative",children:[e.jsx(F,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"name",placeholder:"Seu nome",className:"pl-10",value:s.name,onChange:a=>o({...s,name:a.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"phone",children:"Telefone / WhatsApp"}),e.jsxs("div",{className:"relative",children:[e.jsx(be,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"phone",placeholder:"(11) 99999-9999",className:"pl-10",value:s.phone,onChange:a=>o({...s,phone:a.target.value}),required:!0})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(ye,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"email",type:"email",placeholder:"seu@email.com",className:`pl-10 ${X?"border-destructive":""}`,value:s.email,onChange:a=>{o({...s,email:a.target.value}),Y()},onBlur:()=>{s.email.includes("@")&&K(s.email)},required:!0,disabled:I})]}),e.jsx(ve,{isValidating:I,result:i})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"password",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"password",type:v?"text":"password",placeholder:"••••••••",className:"pl-10 pr-10",value:s.password,onChange:a=>o({...s,password:a.target.value}),required:!0}),e.jsx("button",{type:"button",onClick:()=>Z(!v),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:v?e.jsx(we,{className:"h-4 w-4"}):e.jsx(Ee,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"confirmPassword",children:"Confirmar senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(G,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"confirmPassword",type:v?"text":"password",placeholder:"••••••••",className:"pl-10",value:s.confirmPassword,onChange:a=>o({...s,confirmPassword:a.target.value}),required:!0})]})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"space-y-2 col-span-2 md:col-span-2",children:[e.jsx(l,{htmlFor:"city",children:"Cidade"}),e.jsxs("div",{className:"relative",children:[e.jsx(Ce,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(x,{id:"city",placeholder:"Sua cidade",className:"pl-10",value:s.city,onChange:a=>o({...s,city:a.target.value}),required:!0})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Estado"}),e.jsxs(U,{value:s.state,onValueChange:a=>o({...s,state:a}),children:[e.jsx(V,{children:e.jsx($,{placeholder:"UF"})}),e.jsx(D,{children:ke.map(a=>e.jsx(j,{value:a,children:a},a))})]})]})]})]}),r===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Foto de perfil (opcional)"}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(z,{className:"w-20 h-20",children:[e.jsx(O,{src:w||void 0}),e.jsx(H,{className:"bg-secondary text-2xl",children:s.name?s.name.charAt(0).toUpperCase():e.jsx(F,{className:"h-8 w-8"})})]}),e.jsxs("div",{children:[e.jsx("input",{ref:R,type:"file",accept:"image/*",onChange:ae,className:"hidden"}),e.jsxs(S,{type:"button",variant:"outline",onClick:()=>{var a;return(a=R.current)==null?void 0:a.click()},className:"gap-2",children:[e.jsx(Se,{className:"h-4 w-4"}),w?"Alterar foto":"Adicionar foto"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"JPG, PNG (máx. 2MB)"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"experience",children:"Tempo de experiência"}),e.jsxs(U,{value:s.experience,onValueChange:a=>o({...s,experience:a}),children:[e.jsx(V,{children:e.jsx($,{placeholder:"Selecione"})}),e.jsxs(D,{children:[e.jsx(j,{value:"1-2",children:"1 a 2 anos"}),e.jsx(j,{value:"3-5",children:"3 a 5 anos"}),e.jsx(j,{value:"5-10",children:"5 a 10 anos"}),e.jsx(j,{value:"10+",children:"Mais de 10 anos"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{children:"Especialidades (selecione uma ou mais)"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:Te.map(a=>e.jsx("button",{type:"button",onClick:()=>se(a),className:`px-3 py-2 rounded-lg text-sm font-medium transition-colors ${s.specialties.includes(a)?"bg-primary text-primary-foreground":"bg-secondary text-secondary-foreground hover:bg-secondary/80"}`,children:a},a))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"neighborhoods",children:"Bairros que você atende"}),e.jsx(x,{id:"neighborhoods",placeholder:"Ex: Moema, Itaim Bibi, Vila Mariana",value:s.neighborhoods,onChange:a=>o({...s,neighborhoods:a.target.value})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Separe por vírgula"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"price",children:"Valor da aula (R$)"}),e.jsx(x,{id:"price",type:"number",placeholder:"80",value:s.price,onChange:a=>o({...s,price:a.target.value}),required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"bio",children:"Sobre você"}),e.jsx(ue,{id:"bio",placeholder:"Conte um pouco sobre sua experiência, metodologia e diferenciais...",rows:4,value:s.bio,onChange:a=>o({...s,bio:a.target.value})})]})]}),r===3&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-secondary/50 rounded-xl p-6 space-y-4",children:[e.jsx("h3",{className:"font-semibold text-foreground",children:"Resumo do cadastro"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(z,{className:"w-20 h-20 border-4 border-background shadow-lg",children:[e.jsx(O,{src:w||void 0}),e.jsx(H,{className:"bg-primary/10 text-2xl",children:s.name?s.name.charAt(0).toUpperCase():e.jsx(F,{className:"h-8 w-8"})})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 text-sm",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Nome"}),e.jsx("p",{className:"font-medium text-foreground",children:s.name||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Email"}),e.jsx("p",{className:"font-medium text-foreground",children:s.email||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Telefone"}),e.jsx("p",{className:"font-medium text-foreground",children:s.phone||"-"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Localização"}),e.jsxs("p",{className:"font-medium text-foreground",children:[s.city,", ",s.state]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Experiência"}),e.jsxs("p",{className:"font-medium text-foreground",children:[s.experience||"-"," anos"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground",children:"Valor/aula"}),e.jsxs("p",{className:"font-medium text-foreground",children:["R$ ",s.price||"-"]})]})]}),s.specialties.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:"Especialidades"}),e.jsx("div",{className:"flex flex-wrap gap-1",children:s.specialties.map(a=>e.jsx("span",{className:"px-2 py-1 bg-accent/10 text-accent rounded text-xs",children:a},a))})]})]}),e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx("input",{type:"checkbox",id:"terms",checked:s.terms,onChange:a=>o({...s,terms:a.target.checked}),className:"mt-1 rounded border-input",required:!0}),e.jsxs("label",{htmlFor:"terms",className:"text-sm text-muted-foreground",children:["Li e concordo com os"," ",e.jsx(P,{to:"/termos",className:"text-accent hover:underline",children:"Termos de Uso"})," ","e"," ",e.jsx(P,{to:"/privacidade",className:"text-accent hover:underline",children:"Política de Privacidade"})]})]})]}),e.jsxs("div",{className:"flex gap-4 pt-4",children:[r>1&&e.jsxs(S,{type:"button",variant:"outline",onClick:()=>T(r-1),className:"gap-2",disabled:b,children:[e.jsx(Pe,{className:"h-4 w-4"}),"Voltar"]}),e.jsx(S,{type:"submit",size:"lg",className:"flex-1 gap-2",disabled:b,children:b?e.jsxs(e.Fragment,{children:[e.jsx(Fe,{className:"h-4 w-4 animate-spin"}),"Processando..."]}):r===3?e.jsxs(e.Fragment,{children:["Finalizar cadastro",e.jsx(_,{className:"h-4 w-4"})]}):e.jsxs(e.Fragment,{children:["Continuar",e.jsx(Ae,{className:"h-4 w-4"})]})})]})]}),r===1&&e.jsxs(e.Fragment,{children:[e.jsx("hr",{className:"my-6"}),e.jsx("div",{className:"text-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Já tem cadastro?"," ",e.jsx(P,{to:"/instrutor/login",className:"text-accent hover:underline font-medium",children:"Faça login"})]})})]})]})]})]})}),e.jsx(me,{})]})]})}export{Ge as default};
