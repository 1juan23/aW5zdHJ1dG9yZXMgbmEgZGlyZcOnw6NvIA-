import{j as e}from"./supabase-vendor-zrCfvSZu.js";import{Q as k,u as A,s as P,H as v,C as t,e as r,B as S,F as y,a as n,b as c,d as i,h as $}from"./index-CcM7G_HG.js";import{T as E,a as V,b as f,c as d,d as _,e as l}from"./table-BSGfIRPH.js";import{u as B,r as o}from"./react-vendor-C2tQq_zP.js";import{L as D,ab as I,aj as U,a1 as M,T as q,o as G,Y as Q}from"./ui-vendor-D-xBSbyO.js";import{f as W,p as Y}from"./pt-BR-XEdHDqF9.js";function se(){const{isAdmin:m,loading:h}=k(),w=B(),[x,R]=o.useState({totalVolume:0,platformRevenue:0,instructorPayouts:0,totalLessons:0}),[j,T]=o.useState([]),[F,C]=o.useState(!0),{toast:p}=A(),g=o.useCallback(async()=>{try{const{data:s,error:N}=await P.from("lessons").select("*").order("created_at",{ascending:!1});if(N)throw N;if(s){const u=s.reduce((a,H)=>a+(H.price||0),0),b=u*.15,L=u-b;R({totalVolume:u,platformRevenue:b,instructorPayouts:L,totalLessons:s.length}),T(s.map(a=>({id:a.id,scheduled_at:a.scheduled_at,price:a.price,status:a.status,created_at:a.created_at})))}}catch(s){console.error("Error fetching financial data:",s),p({title:"Erro ao carregar dados",description:"Não foi possível carregar as informações financeiras.",variant:"destructive"})}finally{C(!1)}},[p]);return o.useEffect(()=>{!h&&m&&g()},[g,h,m]),h||F?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx(D,{className:"h-8 w-8 animate-spin text-primary"})}):m?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(v,{}),e.jsx("main",{className:"flex-1 py-8 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs("div",{className:"flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-8",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Gestão Financeira"}),e.jsx("p",{className:"text-muted-foreground",children:"Acompanhe o volume de transações e receitas da plataforma."})]}),e.jsx("div",{className:"flex items-center gap-2 px-4 py-2 bg-primary/10 rounded-full border border-primary/20",children:e.jsx("span",{className:"text-sm font-medium text-primary",children:"Taxa da Plataforma: 15%"})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[e.jsxs(t,{className:"relative overflow-hidden border-none shadow-xl bg-gradient-to-br from-primary to-primary-foreground text-white group",children:[e.jsx("div",{className:"absolute top-0 right-0 p-4 opacity-10 group-hover:scale-110 transition-transform",children:e.jsx(U,{className:"h-12 w-12"})}),e.jsxs(n,{className:"pb-2",children:[e.jsx(c,{className:"text-sm font-medium opacity-80",children:"Volume Total"}),e.jsxs(i,{className:"text-2xl font-bold text-white",children:["R$ ",x.totalVolume.toFixed(2)]})]}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1 text-xs opacity-80",children:[e.jsx(M,{className:"h-3 w-3"}),e.jsx("span",{children:"Total transacionado"})]})})]}),e.jsxs(t,{className:"border-none shadow-xl bg-white dark:bg-slate-900",children:[e.jsxs(n,{className:"pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Receita Plataforma"}),e.jsxs(i,{className:"text-2xl font-bold text-foreground",children:["R$ ",x.platformRevenue.toFixed(2)]})]}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-green-500",children:[e.jsx(q,{className:"h-3 w-3"}),e.jsx("span",{children:"Líquido (15%)"})]})})]}),e.jsxs(t,{className:"border-none shadow-xl bg-white dark:bg-slate-900",children:[e.jsxs(n,{className:"pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Repasse Instrutores"}),e.jsxs(i,{className:"text-2xl font-bold text-foreground",children:["R$ ",x.instructorPayouts.toFixed(2)]})]}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-blue-500",children:[e.jsx(G,{className:"h-3 w-3"}),e.jsx("span",{children:"85% do volume"})]})})]}),e.jsxs(t,{className:"border-none shadow-xl bg-white dark:bg-slate-900",children:[e.jsxs(n,{className:"pb-2",children:[e.jsx(c,{className:"text-sm font-medium text-muted-foreground",children:"Total de Aulas"}),e.jsx(i,{className:"text-2xl font-bold text-foreground",children:x.totalLessons})]}),e.jsx(r,{children:e.jsxs("div",{className:"flex items-center gap-1 text-xs text-muted-foreground",children:[e.jsx(Q,{className:"h-3 w-3"}),e.jsx("span",{children:"Histórico completo"})]})})]})]}),e.jsxs(t,{className:"shadow-xl border-none",children:[e.jsxs(n,{children:[e.jsx(c,{children:"Transações Recentes"}),e.jsx(i,{children:"Lista detalhada das últimas aulas agendadas."})]}),e.jsx(r,{children:e.jsxs(E,{children:[e.jsx(V,{children:e.jsxs(f,{children:[e.jsx(d,{children:"Data"}),e.jsx(d,{children:"Status"}),e.jsx(d,{children:"Total"}),e.jsx(d,{children:"Comissão (15%)"}),e.jsx(d,{className:"text-right",children:"Repasse (85%)"})]})}),e.jsx(_,{children:j.length>0?j.map(s=>e.jsxs(f,{children:[e.jsx(l,{className:"font-medium text-xs",children:W(new Date(s.created_at),"dd/MM/yyyy HH:mm",{locale:Y})}),e.jsx(l,{children:e.jsx($,{variant:s.status==="completed"?"default":s.status==="pending"?"outline":s.status==="cancelled"?"destructive":"secondary",className:`text-[10px] uppercase ${s.status==="completed"?"bg-green-500 hover:bg-green-600":""}`,children:s.status})}),e.jsxs(l,{className:"text-sm font-semibold",children:["R$ ",s.price.toFixed(2)]}),e.jsxs(l,{className:"text-sm text-green-600",children:["R$ ",(s.price*.15).toFixed(2)]}),e.jsxs(l,{className:"text-sm text-right font-medium",children:["R$ ",(s.price*.85).toFixed(2)]})]},s.id)):e.jsx(f,{children:e.jsx(l,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Nenhuma transação encontrada."})})})]})})]})]})}),e.jsx(y,{})]}):e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(v,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center py-12 px-4",children:e.jsx(t,{className:"max-w-md w-full text-center",children:e.jsxs(r,{className:"pt-6 space-y-4",children:[e.jsx(I,{className:"h-16 w-16 text-destructive mx-auto"}),e.jsx("h1",{className:"text-2xl font-bold text-foreground",children:"Acesso Negado"}),e.jsx("p",{className:"text-muted-foreground",children:"Você não tem permissão para acessar esta página. Esta área é restrita a administradores."}),e.jsx(S,{onClick:()=>w("/"),className:"mt-4",children:"Voltar para Início"})]})})}),e.jsx(y,{})]})}export{se as default};
