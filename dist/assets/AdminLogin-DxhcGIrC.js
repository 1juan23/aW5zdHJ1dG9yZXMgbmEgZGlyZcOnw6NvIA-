import{j as e}from"./supabase-vendor-zrCfvSZu.js";import{r as i,u as S,H as A,L as C}from"./react-vendor-C2tQq_zP.js";import{u as k,C as q,a as F,b as V,d as _,e as B,B as D,s as l}from"./index-CcM7G_HG.js";import{I as f}from"./input-CCzeZ9h-.js";import{L as g}from"./label-BuoQyU_D.js";import{l as H,Z as I,g as P}from"./validations-BW1-a5ag.js";import{L as j,O as Z,w,j as z,x as O}from"./ui-vendor-D-xBSbyO.js";const K=()=>{const[n,v]=i.useState(""),[d,b]=i.useState(""),[h,c]=i.useState(!1),[N,y]=i.useState(!0),[r,x]=i.useState({}),m=S(),{toast:o}=k();i.useEffect(()=>{(async()=>{const{data:{session:s}}=await l.auth.getSession();if(s!=null&&s.user){const{data:t}=await l.from("user_roles").select("role").eq("user_id",s.user.id).eq("role","admin");t&&t.length>0&&m("/admin/dashboard")}y(!1)})()},[m]);const E=()=>{x({});try{return H.parse({email:n,password:d}),!0}catch(a){if(a instanceof I){const s={};a.errors.forEach(t=>{t.path[0]&&(s[t.path[0].toString()]=t.message)}),x(s),o({title:"Erro de validação",description:P(a),variant:"destructive"})}return!1}},L=async a=>{if(a.preventDefault(),!!E()){c(!0);try{const{data:s,error:t}=await l.auth.signInWithPassword({email:n.trim(),password:d});if(t)throw t;if(!s.user)throw new Error("Erro ao fazer login");const{data:u,error:p}=await l.from("user_roles").select("role").eq("user_id",s.user.id).eq("role","admin");if(p)throw p;if(!u||u.length===0){await l.auth.signOut(),o({variant:"destructive",title:"Acesso negado",description:"Você não tem permissão de administrador."}),c(!1);return}o({title:"Login realizado!",description:"Bem-vindo ao painel administrativo."}),m("/admin/dashboard")}catch(s){o({variant:"destructive",title:"Erro no login",description:s.message||"Verifique suas credenciais."})}finally{c(!1)}}};return N?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900",children:e.jsx(j,{className:"h-8 w-8 animate-spin text-red-500"})}):e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsx("title",{children:"Login Administrativo | AutoEscola"}),e.jsx("meta",{name:"robots",content:"noindex, nofollow"})]}),e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gradient-to-br from-slate-900 via-slate-800 to-slate-900 px-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs(C,{to:"/",className:"inline-flex items-center gap-2 text-slate-400 hover:text-white mb-8 transition-colors",children:[e.jsx(Z,{className:"h-4 w-4"}),"Voltar ao início"]}),e.jsxs(q,{className:"border-red-900/50 bg-slate-900/80 backdrop-blur-sm",children:[e.jsxs(F,{className:"text-center space-y-4",children:[e.jsx("div",{className:"mx-auto w-16 h-16 rounded-full bg-red-600/20 flex items-center justify-center",children:e.jsx(w,{className:"h-8 w-8 text-red-500"})}),e.jsx("div",{children:e.jsxs("span",{className:"inline-flex items-center gap-1.5 px-3 py-1 rounded-full text-xs font-semibold bg-red-600/20 text-red-400 border border-red-600/30",children:[e.jsx(w,{className:"h-3 w-3"}),"Área Administrativa"]})}),e.jsx(V,{className:"text-2xl text-white",children:"Painel do Administrador"}),e.jsx(_,{className:"text-slate-400",children:"Acesso restrito a administradores do sistema"})]}),e.jsx(B,{children:e.jsxs("form",{onSubmit:L,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"email",className:"text-slate-300",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(z,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-500"}),e.jsx(f,{id:"email",type:"email",placeholder:"admin@exemplo.com",value:n,onChange:a=>v(a.target.value),className:`pl-10 bg-slate-800/50 border-slate-700 text-white placeholder:text-slate-500 ${r.email?"border-red-500":""}`,required:!0})]}),r.email&&e.jsx("p",{className:"text-xs text-red-400",children:r.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(g,{htmlFor:"password",className:"text-slate-300",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(O,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-slate-500"}),e.jsx(f,{id:"password",type:"password",placeholder:"••••••••",value:d,onChange:a=>b(a.target.value),className:`pl-10 bg-slate-800/50 border-slate-700 text-white placeholder:text-slate-500 ${r.password?"border-red-500":""}`,required:!0})]}),r.password&&e.jsx("p",{className:"text-xs text-red-400",children:r.password})]}),e.jsx(D,{type:"submit",className:"w-full bg-red-600 hover:bg-red-700 text-white",disabled:h,children:h?e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-2 h-4 w-4 animate-spin"}),"Verificando..."]}):"Entrar"})]})})]})]})})]})};export{K as default};
