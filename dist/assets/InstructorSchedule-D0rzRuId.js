import{j as e}from"./supabase-vendor-zrCfvSZu.js";import{r as n,u as Z,H as ee}from"./react-vendor-C2tQq_zP.js";import{k as O,l as se,m as te,P as $,n as ae,o as re,c as B,u as ne,s as w,C as E,e as T,h as ie,a as oe,b as ce,B as q,H as le,F as de}from"./index-CcM7G_HG.js";import{u as ue}from"./index-CVM1siHy.js";import{L}from"./label-BuoQyU_D.js";import{q as F,L as z,b as me,a7 as he,a8 as fe}from"./ui-vendor-D-xBSbyO.js";var D="Switch",[xe]=te(D),[pe,ge]=xe(D),Q=n.forwardRef((o,c)=>{const{__scopeSwitch:i,name:m,checked:d,defaultChecked:y,required:x,disabled:h,value:u="on",onCheckedChange:p,form:g,...f}=o,[j,N]=n.useState(null),b=O(c,v=>N(v)),C=n.useRef(!1),P=j?g||!!j.closest("form"):!0,[S,R]=se({prop:d,defaultProp:y??!1,onChange:p,caller:D});return e.jsxs(pe,{scope:i,checked:S,disabled:h,children:[e.jsx($.button,{type:"button",role:"switch","aria-checked":S,"aria-required":x,"data-state":V(S),"data-disabled":h?"":void 0,disabled:h,value:u,...f,ref:b,onClick:ae(o.onClick,v=>{R(H=>!H),P&&(C.current=v.isPropagationStopped(),C.current||v.stopPropagation())})}),P&&e.jsx(K,{control:j,bubbles:!C.current,name:m,value:u,checked:S,required:x,disabled:h,form:g,style:{transform:"translateX(-100%)"}})]})});Q.displayName=D;var W="SwitchThumb",G=n.forwardRef((o,c)=>{const{__scopeSwitch:i,...m}=o,d=ge(W,i);return e.jsx($.span,{"data-state":V(d.checked),"data-disabled":d.disabled?"":void 0,...m,ref:c})});G.displayName=W;var be="SwitchBubbleInput",K=n.forwardRef(({__scopeSwitch:o,control:c,checked:i,bubbles:m=!0,...d},y)=>{const x=n.useRef(null),h=O(x,y),u=ue(i),p=re(c);return n.useEffect(()=>{const g=x.current;if(!g)return;const f=window.HTMLInputElement.prototype,N=Object.getOwnPropertyDescriptor(f,"checked").set;if(u!==i&&N){const b=new Event("click",{bubbles:m});N.call(g,i),g.dispatchEvent(b)}},[u,i,m]),e.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:i,...d,tabIndex:-1,ref:h,style:{...d.style,...p,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});K.displayName=be;function V(o){return o?"checked":"unchecked"}var X=Q,ve=G;const Y=n.forwardRef(({className:o,...c},i)=>e.jsx(X,{className:B("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50",o),...c,ref:i,children:e.jsx(ve,{className:B("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Y.displayName=X.displayName;const U=[{day:"monday",dayName:"Segunda-feira"},{day:"tuesday",dayName:"Ter√ßa-feira"},{day:"wednesday",dayName:"Quarta-feira"},{day:"thursday",dayName:"Quinta-feira"},{day:"friday",dayName:"Sexta-feira"},{day:"saturday",dayName:"S√°bado"},{day:"sunday",dayName:"Domingo"}],je=[{id:"1",start:"08:00",end:"12:00"},{id:"2",start:"14:00",end:"18:00"}];function Ne(){const{toast:o}=ne(),[c,i]=n.useState(U.map(({day:s,dayName:r})=>({day:s,dayName:r,enabled:!1,slots:[]}))),[m,d]=n.useState(!0),[y,x]=n.useState(!1),[h,u]=n.useState("idle"),[p,g]=n.useState(null),f=n.useRef(null),j=n.useRef(!0),N=n.useCallback(async s=>{if(!(!p||j.current)){x(!0),u("saving");try{const{error:r}=await w.from("availability_slots").delete().eq("instructor_id",p);if(r)throw r;const t=s.map((a,l)=>({...a,dayIndex:l})).filter(a=>a.enabled).flatMap(a=>a.slots.map(l=>({instructor_id:p,day_of_week:a.dayIndex,start_time:l.start,end_time:l.end,is_active:!0})));if(t.length>0){const{error:a}=await w.from("availability_slots").insert(t);if(a)throw a}u("saved"),setTimeout(()=>u("idle"),2e3)}catch(r){console.error("Error saving schedule:",r),o({title:"Erro ao salvar",description:"N√£o foi poss√≠vel salvar sua agenda automaticamente.",variant:"destructive"}),u("idle")}finally{x(!1)}}},[p,o]),b=n.useCallback(s=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{N(s)},800)},[N]);n.useEffect(()=>()=>{f.current&&clearTimeout(f.current)},[]);const C=s=>{i(r=>{const t=[...r];return t[s].enabled=!t[s].enabled,t[s].enabled&&t[s].slots.length===0&&(t[s].slots=je.map(a=>({...a,id:`${Date.now()}-${Math.random()}`}))),b(t),t})},P=s=>{i(r=>{const t=[...r],a={id:Date.now().toString(),start:"09:00",end:"17:00"};return t[s].slots.push(a),b(t),t})},S=(s,r)=>{i(t=>{const a=[...t];return a[s].slots=a[s].slots.filter(l=>l.id!==r),b(a),a})},R=(s,r,t,a)=>{i(l=>{const k=[...l],A=k[s].slots.findIndex(I=>I.id===r);return A!==-1&&(k[s].slots[A][t]=a),b(k),k})};n.useEffect(()=>{async function s(){try{const{data:{user:r}}=await w.auth.getUser();if(!r)return;const{data:t}=await w.from("instructors").select("id").eq("user_id",r.id).single();if(!t)return;g(t.id);const{data:a,error:l}=await w.from("availability_slots").select("*").eq("instructor_id",t.id);if(l)throw l;if(a&&a.length>0){const k=U.map(({day:A,dayName:I},J)=>{const M=a.filter(_=>_.day_of_week===J);return{day:A,dayName:I,enabled:M.length>0,slots:M.map(_=>({id:_.id,start:_.start_time.slice(0,5),end:_.end_time.slice(0,5)}))}});i(k)}setTimeout(()=>{j.current=!1},100)}catch(r){console.error("Error loading schedule:",r),o({title:"Erro ao carregar agenda",description:"N√£o foi poss√≠vel carregar seus hor√°rios.",variant:"destructive"})}finally{d(!1)}}s()},[o]);const v=()=>c.filter(s=>s.enabled).length,H=()=>{let s=0;return c.forEach(r=>{r.enabled&&r.slots.forEach(t=>{const a=parseInt(t.start.split(":")[0]),l=parseInt(t.end.split(":")[0]);s+=l-a})}),s};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx(E,{children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Dias Ativos"}),e.jsx("p",{className:"text-2xl font-bold text-foreground",children:v()})]}),e.jsx(F,{className:"h-8 w-8 text-primary/20"})]})})}),e.jsx(E,{children:e.jsx(T,{className:"pt-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Horas/Semana"}),e.jsxs("p",{className:"text-2xl font-bold text-foreground",children:[H(),"h"]})]}),e.jsx(F,{className:"h-8 w-8 text-accent/20"})]})})}),e.jsx(E,{children:e.jsx(T,{className:"pt-6",children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Status"}),e.jsx(ie,{variant:v()>0?"default":"secondary",children:v()>0?"Ativo":"Inativo"})]})})})})]}),e.jsxs(E,{children:[e.jsx(oe,{children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(ce,{children:"Configurar Disponibilidade"}),e.jsxs("div",{className:"flex items-center gap-2",children:[h==="saving"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(z,{className:"h-4 w-4 animate-spin"}),e.jsx("span",{children:"Salvando..."})]}),h==="saved"&&e.jsxs("div",{className:"flex items-center gap-2 text-sm text-green-600",children:[e.jsx(me,{className:"h-4 w-4"}),e.jsx("span",{children:"Salvo!"})]})]})]})}),e.jsx(T,{className:"space-y-6",children:c.map((s,r)=>e.jsxs("div",{className:"border rounded-lg p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Y,{id:`day-${s.day}`,checked:s.enabled,onCheckedChange:()=>C(r)}),e.jsx(L,{htmlFor:`day-${s.day}`,className:"text-base font-semibold cursor-pointer",children:s.dayName})]}),s.enabled&&e.jsxs(q,{variant:"outline",size:"sm",onClick:()=>P(r),className:"gap-2",children:[e.jsx(he,{className:"h-4 w-4"}),"Adicionar Hor√°rio"]})]}),s.enabled&&e.jsx("div",{className:"space-y-3 ml-8",children:s.slots.length===0?e.jsx("p",{className:"text-sm text-muted-foreground",children:'Nenhum hor√°rio configurado. Clique em "Adicionar Hor√°rio" para come√ßar.'}):s.slots.map(t=>e.jsxs("div",{className:"flex items-center gap-3 bg-muted/30 p-3 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(L,{className:"text-sm",children:"Das"}),e.jsx("input",{type:"time",value:t.start,onChange:a=>R(r,t.id,"start",a.target.value),className:"px-3 py-1 border rounded-md text-sm"}),e.jsx(L,{className:"text-sm",children:"√†s"}),e.jsx("input",{type:"time",value:t.end,onChange:a=>R(r,t.id,"end",a.target.value),className:"px-3 py-1 border rounded-md text-sm"})]}),e.jsx(q,{variant:"ghost",size:"sm",onClick:()=>S(r,t.id),className:"text-destructive hover:text-destructive",children:e.jsx(fe,{className:"h-4 w-4"})})]},t.id))})]},s.day))})]}),e.jsx(E,{className:"bg-blue-50 dark:bg-blue-950/30 border-blue-200 dark:border-blue-900",children:e.jsxs(T,{className:"pt-6",children:[e.jsx("h3",{className:"font-semibold mb-2 text-blue-900 dark:text-blue-100",children:"üí° Dica"}),e.jsx("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:"Configure sua disponibilidade semanal. Os alunos poder√£o agendar aulas apenas nos hor√°rios que voc√™ definir como dispon√≠veis. Voc√™ pode adicionar m√∫ltiplos hor√°rios por dia."})]})})]})}function Ee(){const o=Z(),[c,i]=n.useState(!0);return n.useEffect(()=>{async function m(){const{data:{user:d}}=await w.auth.getUser();if(!d){o("/instrutor/login");return}const{data:y}=await w.from("instructors").select("id").eq("user_id",d.id).maybeSingle();if(!y){o("/instrutor/cadastro");return}i(!1)}m()},[o]),c?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-background",children:e.jsx(z,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs(e.Fragment,{children:[e.jsxs(ee,{children:[e.jsx("title",{children:"Minha Agenda | Instrutores na Dire√ß√£o"}),e.jsx("meta",{name:"description",content:"Gerencie sua disponibilidade e hor√°rios de aula"})]}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(le,{}),e.jsx("main",{className:"flex-1 py-8 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-5xl",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Minha Agenda"}),e.jsx("p",{className:"text-muted-foreground",children:"Configure sua disponibilidade e hor√°rios para aulas"})]}),e.jsx(Ne,{})]})}),e.jsx(de,{})]})]})}export{Ee as default};
