import{j as e}from"./supabase-vendor-zrCfvSZu.js";import{r as n,u as Ps,H as Os}from"./react-vendor-C2tQq_zP.js";import{k as Ue,m as Ms,n as Fs,t as zs,c as A,i as Ge,C as w,e as S,h as I,B as g,a as K,b as V,d as Ke,s as D,u as qs}from"./index-CcM7G_HG.js";import{T as me,a as ue,b as L,c as R,d as he,e as b}from"./table-BSGfIRPH.js";import{e as Ve,R as $s,P as Bs,W as Hs,C as Ws,T as Us,f as Gs,g as Ye,O as Ks,h as Vs,D as Xe,a as Je,b as Qe,c as Ze,d as Ys}from"./dialog-C0xQx6hb.js";import{T as es}from"./textarea-FnepGMth.js";import{U as ss,u as Xs,j as Js,P as Qs,k as Oe,s as Zs,q as ee,a2 as et,p as st,b as ve,X as Ee,_ as Y,ac as pe,L as ts,x as de,S as xe,ad as as,m as tt,n as be,B as at,C as rt,ae as Me,T as Fe,af as lt,ag as ze,D as qe,f as nt,o as ne,W as $e,w as it,a0 as ct,Y as Be,y as ot}from"./ui-vendor-D-xBSbyO.js";import{L as dt}from"./label-BuoQyU_D.js";import{I as xt}from"./input-CCzeZ9h-.js";import{S as rs,a as ls,b as ns,c as is,d as ie}from"./select-481qhC-1.js";import{t as X,c as mt,n as ut,f as ge,p as He,s as oe}from"./pt-BR-XEdHDqF9.js";import{R as we,A as cs,C as ht,X as os,Y as pt,T as ye,a as De,L as gt,P as jt,b as ft,c as Nt}from"./charts-vendor-_A0ZI1cA.js";import{s as Ne}from"./subDays-Dj98n0x1.js";import"./index-BdQq_4o_.js";import"./index-CVM1siHy.js";function vt(s,a){const t=+X(s);return mt(s,t+a)}function ds(s,a){return vt(s,a*ut)}function bt(s,a){const t=X(s.start),i=X(s.end);let r=+t>+i;const h=r?+t:+i,m=r?i:t;m.setHours(0,0,0,0);let p=1;const u=[];for(;+m<=h;)u.push(X(m)),m.setDate(m.getDate()+p),m.setHours(0,0,0,0);return r?u.reverse():u}function wt(s,a){const t=X(s.start),i=X(s.end);let r=+t>+i;const h=r?+t:+i;let m=r?i:t;m.setMinutes(0,0,0);let p=1;const u=[];for(;+m<=h;)u.push(X(m)),m=ds(m,p);return r?u.reverse():u}function yt(s,a){return ds(s,-24)}var xs="AlertDialog",[Dt]=Ms(xs,[Ve]),W=Ve(),ms=s=>{const{__scopeAlertDialog:a,...t}=s,i=W(a);return e.jsx($s,{...i,...t,modal:!0})};ms.displayName=xs;var _t="AlertDialogTrigger",At=n.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...i}=s,r=W(t);return e.jsx(Vs,{...r,...i,ref:a})});At.displayName=_t;var St="AlertDialogPortal",us=s=>{const{__scopeAlertDialog:a,...t}=s,i=W(a);return e.jsx(Bs,{...i,...t})};us.displayName=St;var Ct="AlertDialogOverlay",hs=n.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...i}=s,r=W(t);return e.jsx(Ks,{...r,...i,ref:a})});hs.displayName=Ct;var se="AlertDialogContent",[kt,Rt]=Dt(se),Tt=zs("AlertDialogContent"),ps=n.forwardRef((s,a)=>{const{__scopeAlertDialog:t,children:i,...r}=s,h=W(t),m=n.useRef(null),p=Ue(a,m),u=n.useRef(null);return e.jsx(Hs,{contentName:se,titleName:gs,docsSlug:"alert-dialog",children:e.jsx(kt,{scope:t,cancelRef:u,children:e.jsxs(Ws,{role:"alertdialog",...h,...r,ref:p,onOpenAutoFocus:Fs(r.onOpenAutoFocus,j=>{var v;j.preventDefault(),(v=u.current)==null||v.focus({preventScroll:!0})}),onPointerDownOutside:j=>j.preventDefault(),onInteractOutside:j=>j.preventDefault(),children:[e.jsx(Tt,{children:i}),e.jsx(Lt,{contentRef:m})]})})})});ps.displayName=se;var gs="AlertDialogTitle",js=n.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...i}=s,r=W(t);return e.jsx(Us,{...r,...i,ref:a})});js.displayName=gs;var fs="AlertDialogDescription",Ns=n.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...i}=s,r=W(t);return e.jsx(Gs,{...r,...i,ref:a})});Ns.displayName=fs;var Et="AlertDialogAction",vs=n.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...i}=s,r=W(t);return e.jsx(Ye,{...r,...i,ref:a})});vs.displayName=Et;var bs="AlertDialogCancel",ws=n.forwardRef((s,a)=>{const{__scopeAlertDialog:t,...i}=s,{cancelRef:r}=Rt(bs,t),h=W(t),m=Ue(a,r);return e.jsx(Ye,{...h,...i,ref:m})});ws.displayName=bs;var Lt=({contentRef:s})=>{const a=`\`${se}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${se}\` by passing a \`${fs}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${se}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return n.useEffect(()=>{var i;document.getElementById((i=s.current)==null?void 0:i.getAttribute("aria-describedby"))||console.warn(a)},[a,s]),null},It=ms,Pt=us,ys=hs,Ds=ps,_s=vs,As=ws,Ss=js,Cs=Ns;const We=It,Ot=Pt,ks=n.forwardRef(({className:s,...a},t)=>e.jsx(ys,{className:A("fixed inset-0 z-50 bg-black/80 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",s),...a,ref:t}));ks.displayName=ys.displayName;const _e=n.forwardRef(({className:s,...a},t)=>e.jsxs(Ot,{children:[e.jsx(ks,{}),e.jsx(Ds,{ref:t,className:A("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",s),...a})]}));_e.displayName=Ds.displayName;const Ae=({className:s,...a})=>e.jsx("div",{className:A("flex flex-col space-y-2 text-center sm:text-left",s),...a});Ae.displayName="AlertDialogHeader";const Se=({className:s,...a})=>e.jsx("div",{className:A("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",s),...a});Se.displayName="AlertDialogFooter";const Ce=n.forwardRef(({className:s,...a},t)=>e.jsx(Ss,{ref:t,className:A("text-lg font-semibold",s),...a}));Ce.displayName=Ss.displayName;const ke=n.forwardRef(({className:s,...a},t)=>e.jsx(Cs,{ref:t,className:A("text-sm text-muted-foreground",s),...a}));ke.displayName=Cs.displayName;const Re=n.forwardRef(({className:s,...a},t)=>e.jsx(_s,{ref:t,className:A(Ge(),s),...a}));Re.displayName=_s.displayName;const Te=n.forwardRef(({className:s,...a},t)=>e.jsx(As,{ref:t,className:A(Ge({variant:"outline"}),"mt-2 sm:mt-0",s),...a}));Te.displayName=As.displayName;function Mt({instructor:s,open:a,onClose:t,onApprove:i,onReject:r,onSuspend:h}){const[m,p]=n.useState(!1),[u,j]=n.useState("");if(n.useEffect(()=>{a||(p(!1),j(""))},[a]),!s)return null;const v=x=>{switch(x){case"pending":return e.jsx(I,{className:"bg-amber-500/20 text-amber-400 border-amber-500/40 hover:bg-amber-500/30",children:"â³ Pendente"});case"approved":return e.jsx(I,{className:"bg-emerald-500/20 text-emerald-400 border-emerald-500/40 hover:bg-emerald-500/30",children:"âœ… Aprovado"});case"suspended":return e.jsx(I,{className:"bg-red-500/20 text-red-400 border-red-500/40 hover:bg-red-500/30",children:"ðŸš« Suspenso"});default:return null}},z=()=>{i(s),t()},T=()=>{if(!m){p(!0);return}r(s,u),t()},C=()=>{h(),t()};return e.jsx(Xe,{open:a,onOpenChange:t,children:e.jsxs(Je,{className:"bg-slate-800 border-slate-700 max-w-3xl max-h-[90vh] overflow-y-auto",children:[e.jsx(Qe,{children:e.jsxs(Ze,{className:"text-white flex items-center gap-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-slate-700 flex items-center justify-center overflow-hidden border-2 border-slate-600",children:s.avatar_url?e.jsx("img",{src:s.avatar_url,alt:s.name,className:"w-16 h-16 rounded-full object-cover"}):e.jsx(ss,{className:"h-8 w-8 text-slate-400"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xl font-semibold",children:s.name}),e.jsx("div",{className:"flex items-center gap-2 mt-2",children:v(s.status)})]})]})}),e.jsxs("div",{className:"space-y-6 mt-4",children:[e.jsx(w,{className:"bg-red-950/30 border-red-900/50",children:e.jsxs(S,{className:"p-4",children:[e.jsxs("h3",{className:"text-sm font-semibold text-red-400 uppercase tracking-wide mb-3 flex items-center gap-2",children:[e.jsx(Xs,{className:"h-4 w-4"}),"InformaÃ§Ãµes de Contato (Privadas)"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/50 rounded-lg p-3",children:[e.jsx(Js,{className:"h-5 w-5 text-red-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Email"}),e.jsx("p",{className:"text-slate-200 font-medium",children:s.email})]})]}),e.jsxs("div",{className:"flex items-center gap-3 bg-slate-900/50 rounded-lg p-3",children:[e.jsx(Qs,{className:"h-5 w-5 text-red-400"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Telefone"}),e.jsx("p",{className:"text-slate-200 font-medium",children:s.phone})]})]})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 text-slate-300",children:[e.jsx(Oe,{className:"h-5 w-5 text-slate-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"LocalizaÃ§Ã£o"}),e.jsxs("p",{children:[s.city,", ",s.state]})]})]}),e.jsxs("div",{className:"flex items-center gap-3 text-slate-300",children:[e.jsx(Zs,{className:"h-5 w-5 text-slate-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-slate-500",children:"Data de Cadastro"}),e.jsx("p",{children:new Date(s.created_at).toLocaleDateString("pt-BR",{day:"2-digit",month:"long",year:"numeric"})})]})]})]}),e.jsxs("div",{className:"space-y-4",children:[s.neighborhoods&&e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-400 mb-2 flex items-center gap-2",children:[e.jsx(Oe,{className:"h-4 w-4"}),"Bairros de AtuaÃ§Ã£o"]}),e.jsx("p",{className:"text-slate-300",children:s.neighborhoods})]}),s.experience&&e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4",children:[e.jsxs("h4",{className:"text-sm font-medium text-slate-400 mb-2 flex items-center gap-2",children:[e.jsx(ee,{className:"h-4 w-4"}),"Anos de ExperiÃªncia"]}),e.jsx("p",{className:"text-slate-300",children:s.experience})]}),s.specialties&&s.specialties.length>0&&e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 mb-3",children:"Especialidades"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:s.specialties.map((x,l)=>e.jsx(I,{variant:"secondary",className:"bg-slate-700 text-slate-300 hover:bg-slate-600",children:x},l))})]}),s.bio&&e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4",children:[e.jsx("h4",{className:"text-sm font-medium text-slate-400 mb-2",children:"Bio / DescriÃ§Ã£o"}),e.jsx("p",{className:"text-slate-300 whitespace-pre-wrap leading-relaxed",children:s.bio})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 pt-4 border-t border-slate-700",children:[e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 text-center",children:[e.jsx(et,{className:"h-6 w-6 mx-auto text-emerald-500 mb-2"}),e.jsx("p",{className:"text-xs text-slate-500",children:"PreÃ§o/Hora"}),e.jsx("p",{className:"text-xl font-bold text-white",children:s.price?`R$ ${s.price.toFixed(2)}`:"NÃ£o informado"})]}),e.jsxs("div",{className:"bg-slate-900/50 rounded-lg p-4 text-center",children:[e.jsx(st,{className:"h-6 w-6 mx-auto text-amber-500 fill-amber-500 mb-2"}),e.jsx("p",{className:"text-xs text-slate-500",children:"AvaliaÃ§Ã£o"}),e.jsxs("p",{className:"text-xl font-bold text-white",children:[s.rating?s.rating.toFixed(1):"0.0",e.jsxs("span",{className:"text-sm font-normal text-slate-400 ml-1",children:["(",s.total_reviews||0," avaliaÃ§Ãµes)"]})]})]})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4 border-t border-slate-700",children:[s.status==="pending"&&e.jsx(e.Fragment,{children:m?e.jsxs("div",{className:"space-y-3 bg-slate-900/50 p-4 rounded-lg border border-red-500/30",children:[e.jsx("p",{className:"text-sm font-medium text-red-400",children:"Motivo da RejeiÃ§Ã£o"}),e.jsx(es,{placeholder:"Explique por que o perfil foi rejeitado...",className:"bg-slate-800 border-slate-700 text-white min-h-[100px]",value:u,onChange:x=>j(x.target.value)}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx(g,{variant:"ghost",onClick:()=>p(!1),className:"flex-1 text-slate-400 hover:text-white",children:"Cancelar"}),e.jsx(g,{onClick:T,disabled:!u.trim(),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:"Confirmar RejeiÃ§Ã£o"})]})]}):e.jsxs("div",{className:"flex gap-3",children:[e.jsxs(g,{onClick:z,className:"flex-1 bg-emerald-600 hover:bg-emerald-700 text-white",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Aprovar"]}),e.jsxs(g,{onClick:()=>p(!0),className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Rejeitar"]})]})}),s.status==="approved"&&e.jsxs(g,{onClick:C,className:"w-full bg-amber-600 hover:bg-amber-700 text-white",children:[e.jsx(Y,{className:"h-4 w-4 mr-2"}),"Suspender"]}),s.status==="suspended"&&e.jsxs(g,{onClick:z,className:"w-full bg-emerald-600 hover:bg-emerald-700 text-white",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Reativar"]}),e.jsx(g,{variant:"outline",onClick:t,className:"w-full border-slate-600 text-slate-300 hover:bg-slate-700",children:"Fechar"})]})]})]})})}function Ft({instructor:s,open:a,onClose:t,onConfirm:i}){const[r,h]=n.useState(""),[m,p]=n.useState(!1);if(!s)return null;const u=async()=>{if(r.trim()){p(!0);try{await i(r),h(""),t()}finally{p(!1)}}};return e.jsx(Xe,{open:a,onOpenChange:t,children:e.jsxs(Je,{className:"bg-slate-800 border-slate-700 max-w-md",children:[e.jsxs(Qe,{children:[e.jsxs(Ze,{className:"text-white flex items-center gap-2",children:[e.jsx(pe,{className:"h-5 w-5 text-red-400"}),"Suspender Instrutor"]}),e.jsxs(Ys,{className:"text-slate-400",children:["VocÃª estÃ¡ prestes a suspender o instrutor ",e.jsx("strong",{className:"text-white",children:s.name}),"."]})]}),e.jsxs("div",{className:"space-y-4 mt-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs(dt,{htmlFor:"justification",className:"text-slate-200",children:["Justificativa ",e.jsx("span",{className:"text-red-400",children:"*"})]}),e.jsx(es,{id:"justification",placeholder:"Informe o motivo da suspensÃ£o. Esta mensagem serÃ¡ enviada por email ao instrutor...",rows:4,value:r,onChange:j=>h(j.target.value),className:"bg-slate-900 border-slate-700 text-slate-200 placeholder:text-slate-500"}),e.jsx("p",{className:"text-xs text-slate-500",children:"O instrutor receberÃ¡ um email com esta justificativa para poder ajustar seu cadastro."})]}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx(g,{type:"button",variant:"outline",onClick:t,className:"flex-1 border-slate-600 text-slate-300 hover:bg-slate-700",disabled:m,children:"Cancelar"}),e.jsx(g,{onClick:u,disabled:!r.trim()||m,className:"flex-1 bg-red-600 hover:bg-red-700 text-white",children:m?e.jsxs(e.Fragment,{children:[e.jsx(ts,{className:"h-4 w-4 mr-2 animate-spin"}),"Processando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Ee,{className:"h-4 w-4 mr-2"}),"Confirmar SuspensÃ£o"]})})]})]})]})})}function zt(){const[s,a]=n.useState("security"),[t,i]=n.useState([]),[r,h]=n.useState([]),[m,p]=n.useState(!0),[u,j]=n.useState(""),[v,z]=n.useState("all"),[T,C]=n.useState(1),x=20,l=async()=>{p(!0);try{const{data:c,error:q}=await D.from("security_logs").select("*").order("created_at",{ascending:!1}).limit(200);if(q)throw q;i(c||[]);const{data:G,error:$}=await D.from("login_attempts").select("*").order("attempted_at",{ascending:!1}).limit(200);if($)throw $;h(G||[])}catch(c){console.error("Error fetching security data:",c)}finally{p(!1)}};n.useEffect(()=>{l()},[]);const o=c=>{switch(c){case"login_success":return"bg-green-500/10 text-green-500 border-green-500/30";case"login_failed":return"bg-red-500/10 text-red-500 border-red-500/30";case"account_locked":return"bg-amber-500/10 text-amber-500 border-amber-500/30";case"rate_limit":return"bg-orange-500/10 text-orange-500 border-orange-500/30";default:return"bg-blue-500/10 text-blue-500 border-blue-500/30"}},k=c=>{switch(c){case"login_success":return e.jsx(be,{className:"w-4 h-4"});case"login_failed":return e.jsx(Y,{className:"w-4 h-4"});case"account_locked":return e.jsx(de,{className:"w-4 h-4"});case"rate_limit":return e.jsx(pe,{className:"w-4 h-4"});default:return e.jsx(xe,{className:"w-4 h-4"})}},F=c=>{switch(c){case"login_success":return"Login Sucesso";case"login_failed":return"Login Falha";case"account_locked":return"Conta Bloqueada";case"rate_limit":return"Rate Limit";default:return c}},B=Array.from(new Set(t.map(c=>c.event_type))),P=t.filter(c=>{var $,Z;const q=!u||(($=c.email)==null?void 0:$.toLowerCase().includes(u.toLowerCase()))||((Z=c.ip_address)==null?void 0:Z.includes(u)),G=v==="all"||c.event_type===v;return q&&G}),_=P.slice((T-1)*x,T*x),f=r.filter(c=>{var q;return!u||c.email.toLowerCase().includes(u.toLowerCase())||((q=c.ip_address)==null?void 0:q.includes(u))}),N=f.slice((T-1)*x,T*x),J=r.filter(c=>!c.success).length,U=t.filter(c=>c.event_type==="account_locked").length,te=t.filter(c=>c.event_type==="rate_limit").length,je=r.filter(c=>{const q=new Date(c.attempted_at),G=new Date;return!c.success&&G.getTime()-q.getTime()<1440*60*1e3}).length,Q=Math.ceil((s==="security"?P.length:f.length)/x);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsx(w,{className:"border-red-500/20 bg-red-500/5",children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-red-500/10",children:e.jsx(Y,{className:"w-5 h-5 text-red-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-red-500",children:J}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Logins Falhos"})]})]})})}),e.jsx(w,{className:"border-amber-500/20 bg-amber-500/5",children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-amber-500/10",children:e.jsx(de,{className:"w-5 h-5 text-amber-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-amber-500",children:U}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Contas Bloqueadas"})]})]})})}),e.jsx(w,{className:"border-orange-500/20 bg-orange-500/5",children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-orange-500/10",children:e.jsx(pe,{className:"w-5 h-5 text-orange-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-orange-500",children:te}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Rate Limits"})]})]})})}),e.jsx(w,{className:"border-blue-500/20 bg-blue-500/5",children:e.jsx(S,{className:"p-4",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"p-2 rounded-lg bg-blue-500/10",children:e.jsx(ee,{className:"w-5 h-5 text-blue-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-2xl font-bold text-blue-500",children:je}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Falhas (24h)"})]})]})})})]}),e.jsxs(w,{children:[e.jsxs(K,{className:"pb-4",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs(V,{className:"flex items-center gap-2",children:[e.jsx(xe,{className:"w-5 h-5 text-primary"}),"Logs de SeguranÃ§a"]}),e.jsx(Ke,{children:"Monitore tentativas de login e eventos de seguranÃ§a"})]}),e.jsxs(g,{variant:"outline",size:"sm",onClick:l,disabled:m,children:[e.jsx(as,{className:A("w-4 h-4 mr-2",m&&"animate-spin")}),"Atualizar"]})]}),e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsxs(g,{variant:s==="security"?"default":"outline",size:"sm",onClick:()=>{a("security"),C(1)},children:[e.jsx(xe,{className:"w-4 h-4 mr-2"}),"Eventos de SeguranÃ§a"]}),e.jsxs(g,{variant:s==="login"?"default":"outline",size:"sm",onClick:()=>{a("login"),C(1)},children:[e.jsx(de,{className:"w-4 h-4 mr-2"}),"Tentativas de Login"]})]}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 mt-4",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(tt,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground"}),e.jsx(xt,{placeholder:"Buscar por email ou IP...",value:u,onChange:c=>{j(c.target.value),C(1)},className:"pl-10"})]}),s==="security"&&e.jsxs(rs,{value:v,onValueChange:c=>{z(c),C(1)},children:[e.jsx(ls,{className:"w-full sm:w-48",children:e.jsx(ns,{placeholder:"Tipo de evento"})}),e.jsxs(is,{children:[e.jsx(ie,{value:"all",children:"Todos os tipos"}),B.map(c=>e.jsx(ie,{value:c,children:F(c)},c))]})]})]})]}),e.jsxs(S,{children:[s==="security"&&e.jsx("div",{className:"rounded-lg border overflow-hidden",children:e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(L,{children:[e.jsx(R,{children:"Tipo"}),e.jsx(R,{children:"Email"}),e.jsx(R,{children:"IP"}),e.jsx(R,{children:"Detalhes"}),e.jsx(R,{children:"Data/Hora"})]})}),e.jsx(he,{children:m?e.jsx(L,{children:e.jsx(b,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Carregando..."})}):_.length===0?e.jsx(L,{children:e.jsx(b,{colSpan:5,className:"text-center py-8 text-muted-foreground",children:"Nenhum log encontrado"})}):_.map(c=>e.jsxs(L,{children:[e.jsx(b,{children:e.jsxs(I,{className:A("gap-1",o(c.event_type)),children:[k(c.event_type),F(c.event_type)]})}),e.jsx(b,{className:"font-mono text-sm",children:c.email||"-"}),e.jsx(b,{className:"font-mono text-sm text-muted-foreground",children:c.ip_address||"-"}),e.jsx(b,{className:"max-w-xs truncate text-sm text-muted-foreground",children:c.details?JSON.stringify(c.details):"-"}),e.jsx(b,{className:"text-sm text-muted-foreground whitespace-nowrap",children:ge(new Date(c.created_at),"dd/MM/yyyy HH:mm:ss",{locale:He})})]},c.id))})]})}),s==="login"&&e.jsx("div",{className:"rounded-lg border overflow-hidden",children:e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(L,{children:[e.jsx(R,{children:"Status"}),e.jsx(R,{children:"Email"}),e.jsx(R,{children:"IP"}),e.jsx(R,{children:"Data/Hora"})]})}),e.jsx(he,{children:m?e.jsx(L,{children:e.jsx(b,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"Carregando..."})}):N.length===0?e.jsx(L,{children:e.jsx(b,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"Nenhuma tentativa encontrada"})}):N.map(c=>e.jsxs(L,{children:[e.jsx(b,{children:c.success?e.jsxs(I,{className:"bg-green-500/10 text-green-500 border-green-500/30 gap-1",children:[e.jsx(be,{className:"w-3 h-3"}),"Sucesso"]}):e.jsxs(I,{className:"bg-red-500/10 text-red-500 border-red-500/30 gap-1",children:[e.jsx(Y,{className:"w-3 h-3"}),"Falha"]})}),e.jsx(b,{className:"font-mono text-sm",children:c.email}),e.jsx(b,{className:"font-mono text-sm text-muted-foreground",children:c.ip_address||"-"}),e.jsx(b,{className:"text-sm text-muted-foreground whitespace-nowrap",children:ge(new Date(c.attempted_at),"dd/MM/yyyy HH:mm:ss",{locale:He})})]},c.id))})]})}),Q>1&&e.jsxs("div",{className:"flex items-center justify-between mt-4 pt-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["PÃ¡gina ",T," de ",Q]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(g,{variant:"outline",size:"sm",onClick:()=>C(c=>Math.max(1,c-1)),disabled:T===1,children:e.jsx(at,{className:"w-4 h-4"})}),e.jsx(g,{variant:"outline",size:"sm",onClick:()=>C(c=>Math.min(Q,c+1)),disabled:T===Q,children:e.jsx(rt,{className:"w-4 h-4"})})]})]})]})]})]})}const M={success:"#22c55e",failure:"#ef4444",locked:"#f59e0b",rateLimit:"#f97316",other:"#6366f1"};function qt(){const[s,a]=n.useState("7d"),[t,i]=n.useState([]),[r,h]=n.useState([]),[m,p]=n.useState(!0),u=async()=>{p(!0);try{const l=Ne(new Date,s==="24h"?1:s==="7d"?7:30).toISOString(),[o,k]=await Promise.all([D.from("security_logs").select("*").gte("created_at",l).order("created_at",{ascending:!0}),D.from("login_attempts").select("*").gte("attempted_at",l).order("attempted_at",{ascending:!0})]);o.data&&i(o.data),k.data&&h(k.data)}catch(x){console.error("Error fetching analytics:",x)}finally{p(!1)}};n.useEffect(()=>{u()},[s]);const j=n.useMemo(()=>s==="24h"?wt({start:yt(new Date),end:new Date}).map(o=>{const k=ge(o,"HH:00"),F=new Date(o.getTime()+3600*1e3),B=r.filter(f=>{const N=new Date(f.attempted_at);return!f.success&&N>=o&&N<F}).length,P=r.filter(f=>{const N=new Date(f.attempted_at);return f.success&&N>=o&&N<F}).length,_=t.filter(f=>{const N=new Date(f.created_at);return f.event_type==="account_locked"&&N>=o&&N<F}).length;return{name:k,falhas:B,sucessos:P,bloqueios:_}}):bt({start:Ne(new Date,s==="7d"?7:30),end:new Date}).map(l=>{const o=ge(l,"dd/MM"),k=new Date(oe(l).getTime()+1440*60*1e3),F=r.filter(_=>{const f=new Date(_.attempted_at);return!_.success&&f>=oe(l)&&f<k}).length,B=r.filter(_=>{const f=new Date(_.attempted_at);return _.success&&f>=oe(l)&&f<k}).length,P=t.filter(_=>{const f=new Date(_.created_at);return _.event_type==="account_locked"&&f>=oe(l)&&f<k}).length;return{name:o,falhas:F,sucessos:B,bloqueios:P}}),[r,t,s]),v=n.useMemo(()=>{const x=t.reduce((l,o)=>(l[o.event_type]=(l[o.event_type]||0)+1,l),{});return Object.entries(x).map(([l,o])=>({name:l==="login_success"?"Sucesso":l==="login_failed"?"Falha":l==="account_locked"?"Bloqueio":l==="rate_limit"?"Rate Limit":l,value:o,color:l==="login_success"?M.success:l==="login_failed"?M.failure:l==="account_locked"?M.locked:l==="rate_limit"?M.rateLimit:M.other}))},[t]),z=n.useMemo(()=>{const x=r.filter(l=>!l.success).reduce((l,o)=>(l[o.email]=(l[o.email]||0)+1,l),{});return Object.entries(x).sort(([,l],[,o])=>o-l).slice(0,5).map(([l,o])=>({email:l,count:o}))},[r]),T=n.useMemo(()=>{const x=r.filter(l=>!l.success&&l.ip_address).reduce((l,o)=>(l[o.ip_address]=(l[o.ip_address]||0)+1,l),{});return Object.entries(x).sort(([,l],[,o])=>o-l).slice(0,5).map(([l,o])=>({ip:l,count:o}))},[r]),C=n.useMemo(()=>{const x=r.length,l=r.filter(N=>!N.success).length,o=x>0?((x-l)/x*100).toFixed(1):"0",k=t.filter(N=>N.event_type==="account_locked").length,F=new Set(r.filter(N=>!N.success).map(N=>N.ip_address).filter(Boolean)).size,B=s==="24h"?12:s==="7d"?3.5:15,P=r.filter((N,J)=>{const U=new Date(N.attempted_at),te=Ne(new Date,B);return!N.success&&U>=te}).length,_=l-P,f=_>0?((P-_)/_*100).toFixed(0):"0";return{totalAttempts:x,failedAttempts:l,successRate:o,blockedAccounts:k,uniqueAttackerIPs:F,trend:parseInt(f)}},[r,t,s]);return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(Me,{className:"w-6 h-6 text-primary"}),"Analytics de SeguranÃ§a"]}),e.jsx("p",{className:"text-muted-foreground text-sm mt-1",children:"TendÃªncias e padrÃµes de ataques ao longo do tempo"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(rs,{value:s,onValueChange:x=>a(x),children:[e.jsx(ls,{className:"w-32",children:e.jsx(ns,{})}),e.jsxs(is,{children:[e.jsx(ie,{value:"24h",children:"Ãšltimas 24h"}),e.jsx(ie,{value:"7d",children:"Ãšltimos 7 dias"}),e.jsx(ie,{value:"30d",children:"Ãšltimos 30 dias"})]})]}),e.jsx(g,{variant:"outline",size:"icon",onClick:u,disabled:m,children:e.jsx(as,{className:A("w-4 h-4",m&&"animate-spin")})})]})]}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-5 gap-4",children:[e.jsx(w,{className:"border-blue-500/20 bg-blue-500/5",children:e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Me,{className:"w-4 h-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Total Tentativas"})]}),e.jsx("p",{className:"text-2xl font-bold mt-2 text-blue-600",children:C.totalAttempts})]})}),e.jsx(w,{className:"border-red-500/20 bg-red-500/5",children:e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"w-4 h-4 text-red-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Falhas"})]}),e.jsx("p",{className:"text-2xl font-bold mt-2 text-red-600",children:C.failedAttempts}),e.jsxs("div",{className:"flex items-center gap-1 mt-1",children:[C.trend>0?e.jsx(Fe,{className:"w-3 h-3 text-red-500"}):e.jsx(lt,{className:"w-3 h-3 text-green-500"}),e.jsxs("span",{className:A("text-xs font-medium",C.trend>0?"text-red-500":"text-green-500"),children:[C.trend>0?"+":"",C.trend,"%"]})]})]})}),e.jsx(w,{className:"border-green-500/20 bg-green-500/5",children:e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(be,{className:"w-4 h-4 text-green-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Taxa Sucesso"})]}),e.jsxs("p",{className:"text-2xl font-bold mt-2 text-green-600",children:[C.successRate,"%"]})]})}),e.jsx(w,{className:"border-amber-500/20 bg-amber-500/5",children:e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(de,{className:"w-4 h-4 text-amber-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"Bloqueios"})]}),e.jsx("p",{className:"text-2xl font-bold mt-2 text-amber-600",children:C.blockedAccounts})]})}),e.jsx(w,{className:"border-purple-500/20 bg-purple-500/5",children:e.jsxs(S,{className:"p-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-purple-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"IPs Atacantes"})]}),e.jsx("p",{className:"text-2xl font-bold mt-2 text-purple-600",children:C.uniqueAttackerIPs})]})})]}),e.jsxs(w,{children:[e.jsxs(K,{children:[e.jsxs(V,{className:"text-lg flex items-center gap-2",children:[e.jsx(Fe,{className:"w-5 h-5 text-primary"}),"TendÃªncia de Ataques"]}),e.jsx(Ke,{children:"ComparaÃ§Ã£o de tentativas de login falhas, sucessos e bloqueios"})]}),e.jsx(S,{children:e.jsx("div",{className:"h-[300px]",children:e.jsx(we,{width:"100%",height:"100%",children:e.jsxs(cs,{data:j,children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"colorFalhas",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:M.failure,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:M.failure,stopOpacity:0})]}),e.jsxs("linearGradient",{id:"colorSucessos",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:M.success,stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:M.success,stopOpacity:0})]})]}),e.jsx(ht,{strokeDasharray:"3 3",stroke:"hsl(var(--border))"}),e.jsx(os,{dataKey:"name",tick:{fontSize:11},stroke:"hsl(var(--muted-foreground))"}),e.jsx(pt,{tick:{fontSize:11},stroke:"hsl(var(--muted-foreground))"}),e.jsx(ye,{contentStyle:{borderRadius:"8px",border:"1px solid hsl(var(--border))",backgroundColor:"hsl(var(--background))"}}),e.jsx(De,{type:"monotone",dataKey:"falhas",name:"Falhas",stroke:M.failure,strokeWidth:2,fillOpacity:1,fill:"url(#colorFalhas)"}),e.jsx(De,{type:"monotone",dataKey:"sucessos",name:"Sucessos",stroke:M.success,strokeWidth:2,fillOpacity:1,fill:"url(#colorSucessos)"}),e.jsx(gt,{type:"monotone",dataKey:"bloqueios",name:"Bloqueios",stroke:M.locked,strokeWidth:2,dot:{fill:M.locked,strokeWidth:2}})]})})})})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs(w,{children:[e.jsx(K,{className:"pb-2",children:e.jsx(V,{className:"text-sm font-medium",children:"DistribuiÃ§Ã£o de Eventos"})}),e.jsxs(S,{children:[e.jsx("div",{className:"h-[200px]",children:e.jsx(we,{width:"100%",height:"100%",children:e.jsxs(jt,{children:[e.jsx(ft,{data:v,cx:"50%",cy:"50%",innerRadius:50,outerRadius:80,paddingAngle:2,dataKey:"value",children:v.map((x,l)=>e.jsx(Nt,{fill:x.color},`cell-${l}`))}),e.jsx(ye,{})]})})}),e.jsx("div",{className:"flex flex-wrap justify-center gap-2 mt-2",children:v.map(x=>e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-2 h-2 rounded-full",style:{backgroundColor:x.color}}),e.jsx("span",{className:"text-xs text-muted-foreground",children:x.name})]},x.name))})]})]}),e.jsxs(w,{children:[e.jsx(K,{className:"pb-2",children:e.jsxs(V,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(pe,{className:"w-4 h-4 text-amber-500"}),"Emails Mais Atacados"]})}),e.jsx(S,{children:e.jsx("div",{className:"space-y-3",children:z.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum ataque registrado"}):z.map((x,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"outline",className:"w-6 h-6 p-0 justify-center text-xs",children:l+1}),e.jsx("span",{className:"text-sm font-mono truncate max-w-[150px]",children:x.email})]}),e.jsx(I,{variant:"destructive",className:"text-xs",children:x.count})]},x.email))})})]}),e.jsxs(w,{children:[e.jsx(K,{className:"pb-2",children:e.jsxs(V,{className:"text-sm font-medium flex items-center gap-2",children:[e.jsx(ze,{className:"w-4 h-4 text-purple-500"}),"IPs Suspeitos"]})}),e.jsx(S,{children:e.jsx("div",{className:"space-y-3",children:T.length===0?e.jsx("p",{className:"text-sm text-muted-foreground text-center py-4",children:"Nenhum IP registrado"}):T.map((x,l)=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(I,{variant:"outline",className:"w-6 h-6 p-0 justify-center text-xs",children:l+1}),e.jsx("span",{className:"text-sm font-mono",children:x.ip})]}),e.jsx(I,{className:"bg-purple-500/10 text-purple-500 border-purple-500/30 text-xs",children:x.count})]},x.ip))})})]})]})]})}function $t(){const s=n.useRef(new Set),a=n.useCallback(i=>{const r=`${i.type}-${i.email||"global"}-${Date.now()}`;if(s.current.has(r))return;s.current.add(r),setTimeout(()=>s.current.delete(r),6e4);const h={burst_attempts:{title:"âš ï¸ Burst de Tentativas Detectado",description:`${i.attemptCount} tentativas de login para ${i.email} nos Ãºltimos ${i.timeWindowMinutes} minutos`},multiple_ips:{title:"ðŸ”´ MÃºltiplos IPs Detectados",description:`${i.ipCount} IPs diferentes tentaram acessar ${i.email}`},distributed_attack:{title:"ðŸš¨ Ataque DistribuÃ­do Detectado",description:`PadrÃ£o suspeito: ${i.attemptCount} tentativas de ${i.ipCount} IPs em ${i.timeWindowMinutes}min`}},{title:m,description:p}=h[i.type];qe.error(m,{description:p,duration:15e3,action:{label:"Ver Logs",onClick:()=>{window.dispatchEvent(new CustomEvent("navigate-to-security"))}}}),"Notification"in window&&Notification.permission==="granted"&&new Notification(m,{body:p,icon:"/logo.png",tag:r})},[]),t=n.useCallback(async()=>{try{const i=new Date(Date.now()-3e5).toISOString(),{data:r,error:h}=await D.from("login_attempts").select("*").eq("success",!1).gte("attempted_at",i).order("attempted_at",{ascending:!1});if(h||!(r!=null&&r.length))return;const m=r.reduce((u,j)=>{const v=j.email;return u[v]||(u[v]=[]),u[v].push(j),u},{});for(const[u,j]of Object.entries(m)){j.length>=5&&a({type:"burst_attempts",email:u,attemptCount:j.length,timeWindowMinutes:5});const v=new Set(j.map(z=>z.ip_address).filter(Boolean));v.size>=3&&a({type:"multiple_ips",email:u,ipCount:v.size,timeWindowMinutes:5})}const p=new Set(r.map(u=>u.ip_address).filter(Boolean));r.length>=10&&p.size>=5&&a({type:"distributed_attack",attemptCount:r.length,ipCount:p.size,timeWindowMinutes:5})}catch(i){console.error("Error analyzing security patterns:",i)}},[a]);return n.useEffect(()=>{"Notification"in window&&Notification.permission==="default"&&Notification.requestPermission(),t();const i=D.channel("admin-security-monitor").on("postgres_changes",{event:"INSERT",schema:"public",table:"login_attempts"},h=>{h.new&&!h.new.success&&t()}).on("postgres_changes",{event:"INSERT",schema:"public",table:"security_logs"},h=>{if(h.new){const{event_type:m,email:p}=h.new;m==="account_locked"&&qe.warning("ðŸ”’ Conta Bloqueada",{description:`${p||"Uma conta"} foi bloqueada por tentativas excessivas`,duration:1e4})}}).subscribe(),r=setInterval(t,3e4);return()=>{D.removeChannel(i),clearInterval(r)}},[t]),{analyzeRecentAttempts:t}}function ra(){const s=Ps(),{toast:a}=qs();$t();const[t,i]=n.useState("instructors"),[r,h]=n.useState(!0),[m,p]=n.useState(""),[u,j]=n.useState([]),[v,z]=n.useState([]),[T,C]=n.useState([]),[x,l]=n.useState(!1),[o,k]=n.useState(null),[F,B]=n.useState(null),[P,_]=n.useState(!1),[f,N]=n.useState(!1),[J,U]=n.useState(!1),[te,je]=n.useState(0),[Q,c]=n.useState(0),[q,G]=n.useState([]),$=n.useCallback(async()=>{var d;h(!0);try{const{data:{user:y}}=await D.auth.getUser();if(!y){s("/admin/login");return}const{data:O}=await D.from("user_roles").select("role").eq("user_id",y.id).eq("role","admin").maybeSingle();if(!O){s("/");return}p(((d=y.user_metadata)==null?void 0:d.full_name)||"Administrador");const E=D,{data:H}=await E.from("instructors").select("*").order("created_at",{ascending:!1}),{data:ae}=await E.from("profiles").select("*").eq("role","student").order("created_at",{ascending:!1}),{data:Es}=await E.from("admin_action_logs").select("*, instructors(name)").order("created_at",{ascending:!1});j(H||[]),z(ae||[]),C(Es||[]);const{data:ce,error:Pe}=await E.from("lessons").select("created_at, price");if(Pe)console.error("Error fetching lessons:",Pe),G([{name:"Seg",aulas:12},{name:"Ter",aulas:19},{name:"Qua",aulas:15},{name:"Qui",aulas:22},{name:"Sex",aulas:28},{name:"Sab",aulas:35},{name:"Dom",aulas:10}]);else if(ce){je(ce.length);const Ls=ce.reduce((re,le)=>re+(Number(le.price)||0),0);c(Ls);const Is=Array.from({length:7},(re,le)=>{const fe=new Date;return fe.setDate(fe.getDate()-le),fe.toISOString().split("T")[0]}).reverse().map(re=>({name:new Date(re).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}),aulas:ce.filter(le=>le.created_at.startsWith(re)).length}));G(Is)}}catch(y){console.error("Error in checkAdminAndFetch:",y),a({title:"Erro",description:"Falha ao carregar dados.",variant:"destructive"})}finally{h(!1)}},[s,a]);n.useEffect(()=>{$()},[$]);const Z=(d,y)=>{B(d),k(y),d==="approve"&&_(!0),d==="reject"&&N(!0),d==="suspend"&&U(!0)},Le=async()=>{if(o)try{const{error:d}=await D.from("instructors").update({status:"approved"}).eq("id",o.id);if(d)throw d;a({title:"Instrutor aprovado",description:`${o.name} foi aprovado com sucesso.`}),j(O=>O.map(E=>E.id===o.id?{...E,status:"approved"}:E));const{data:{user:y}}=await D.auth.getUser();await D.from("admin_action_logs").insert({action:"approve",admin_user_id:y==null?void 0:y.id,target_instructor_id:o.id,new_status:"approved",previous_status:o.status}),_(!1)}catch(d){console.error(d),a({title:"Ops!",description:"NÃ£o foi possÃ­vel processar a aprovaÃ§Ã£o agora.",variant:"destructive"})}},Ie=async(d,y)=>{try{const{data:{user:O}}=await D.auth.getUser();if(!O)return;const{error:E}=await D.from("instructors").update({status:"suspended"}).eq("id",d.id);if(E)throw E;await D.from("admin_action_logs").insert({admin_user_id:O.id,target_instructor_id:d.id,action:"reject",previous_status:d.status,new_status:"suspended",notes:y}),a({title:"Sucesso",description:`O perfil de ${d.name} foi rejeitado.`}),j(H=>H.map(ae=>ae.id===d.id?{...ae,status:"suspended"}:ae)),k(null),N(!1),D.functions.invoke("send-suspension-email",{body:{instructorId:d.id,justification:y}}).catch(H=>console.error("Email notify error:",H))}catch(O){console.error("Error rejecting instructor:",O),a({title:"Erro",description:"NÃ£o foi possÃ­vel rejeitar o instrutor.",variant:"destructive"})}},Rs=async d=>{if(o)try{const{error:y}=await D.from("instructors").update({status:"suspended"}).eq("id",o.id);if(y)throw y;a({title:"Sucesso",description:"O status do instrutor foi atualizado."}),j(E=>E.map(H=>H.id===o.id?{...H,status:"suspended"}:H)),U(!1);const{data:{user:O}}=await D.auth.getUser();await D.from("admin_action_logs").insert({action:"suspend",admin_user_id:O==null?void 0:O.id,target_instructor_id:o.id,new_status:"suspended",previous_status:o.status,notes:d}),D.functions.invoke("send-suspension-email",{body:{instructorId:o.id,justification:d}}).catch(E=>console.error("Email notify error:",E))}catch(y){console.error("Error suspending instructor:",y),a({title:"Erro",description:"Falha ao suspender instrutor.",variant:"destructive"})}},Ts=async()=>{await D.auth.signOut(),s("/admin/login")};return r?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(ts,{className:"w-8 h-8 animate-spin"})}):e.jsxs("div",{className:"min-h-screen bg-slate-50 dark:bg-slate-900 pb-20 md:pb-0",children:[e.jsx(Os,{children:e.jsx("title",{children:"Dashboard Administrativo | AutoEscola"})}),e.jsxs("header",{className:"bg-white dark:bg-slate-800 p-4 flex justify-between items-center shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-10 h-10 rounded-full bg-slate-200 dark:bg-slate-700 flex items-center justify-center",children:e.jsx(ss,{className:"h-6 w-6 text-slate-500"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-xs text-muted-foreground",children:"Bom dia,"}),e.jsx("h1",{className:"font-bold text-sm leading-none",children:m})]})]}),e.jsx(g,{variant:"ghost",size:"icon",className:"relative text-muted-foreground",onClick:Ts,children:e.jsx(nt,{className:"h-5 w-5"})})]}),e.jsxs("main",{className:"p-4 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(w,{className:"border-none shadow-sm",children:e.jsxs(S,{className:"p-4 flex flex-col justify-between h-full",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(ne,{className:"h-4 w-4 text-blue-600"})}),e.jsx(ne,{className:"h-4 w-4 text-slate-300"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h3",{className:"text-2xl font-bold",children:u.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Instrutores"}),e.jsx("span",{className:"text-[10px] text-green-500 font-bold flex items-center gap-1",children:"â†— +2%"})]})]})}),e.jsx(w,{className:"border-none shadow-sm",children:e.jsxs(S,{className:"p-4 flex flex-col justify-between h-full",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(ne,{className:"h-4 w-4 text-purple-600"})}),e.jsx(ne,{className:"h-4 w-4 text-slate-300"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h3",{className:"text-2xl font-bold",children:v.length}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Novos Alunos"}),e.jsx("span",{className:"text-[10px] text-green-500 font-bold flex items-center gap-1",children:"â†— +12% (7d)"})]})]})}),e.jsx(w,{className:"border-none shadow-sm",children:e.jsxs(S,{className:"p-4 flex flex-col justify-between h-full",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-orange-100 flex items-center justify-center",children:e.jsx(ee,{className:"h-4 w-4 text-orange-600"})}),e.jsx(ee,{className:"h-4 w-4 text-slate-300"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx("h3",{className:"text-2xl font-bold",children:te}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Agendados"}),e.jsx("span",{className:"text-[10px] text-slate-400 font-medium",children:"Total de aulas"})]})]})}),e.jsx(w,{className:"border-none shadow-sm",children:e.jsxs(S,{className:"p-4 flex flex-col justify-between h-full",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx("span",{className:"h-4 w-4 flex items-center justify-center font-bold text-green-600",children:"$"})}),e.jsx("span",{className:"h-4 w-4 font-bold text-slate-300",children:"$"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("h3",{className:"text-2xl font-bold",children:["R$ ",(Q/100).toFixed(2)]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Receita"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:"R$ 45.200 (MÃªs)"})]})]})})]}),e.jsxs(w,{className:"border-none shadow-sm",children:[e.jsxs(K,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx(V,{className:"text-lg font-bold",children:"TendÃªncia de Aulas"}),e.jsx(I,{variant:"secondary",className:"font-normal",children:"7 dias"})]}),e.jsx(S,{children:e.jsx("div",{className:"h-[200px] w-full",children:e.jsx(we,{width:"100%",height:"100%",children:e.jsxs(cs,{data:q,children:[e.jsx("defs",{children:e.jsxs("linearGradient",{id:"colorAulas",x1:"0",y1:"0",x2:"0",y2:"1",children:[e.jsx("stop",{offset:"5%",stopColor:"#3b82f6",stopOpacity:.3}),e.jsx("stop",{offset:"95%",stopColor:"#3b82f6",stopOpacity:0})]})}),e.jsx(os,{dataKey:"name",axisLine:!1,tickLine:!1,tick:{fontSize:10}}),e.jsx(ye,{contentStyle:{borderRadius:"8px",border:"none",boxShadow:"0 4px 6px -1px rgb(0 0 0 / 0.1)"},cursor:{stroke:"#e2e8f0",strokeWidth:1}}),e.jsx(De,{type:"monotone",dataKey:"aulas",stroke:"#3b82f6",strokeWidth:2,fillOpacity:1,fill:"url(#colorAulas)"})]})})})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-bold mb-4",children:"AÃ§Ãµes RÃ¡pidas"}),e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs(g,{variant:t==="instructors"?"default":"outline",className:A("h-24 flex flex-col gap-2",t==="instructors"&&"bg-primary text-white"),onClick:()=>{i("instructors"),l(!1)},children:[e.jsx("div",{className:A("p-2 rounded-full",t==="instructors"?"bg-white/20":"bg-primary/10 text-primary"),children:e.jsx($e,{className:"w-6 h-6"})}),"Instrutores"]}),e.jsxs(g,{variant:t==="students"?"default":"outline",className:A("h-24 flex flex-col gap-2",t==="students"&&"bg-primary text-white"),onClick:()=>{i("students"),l(!1)},children:[e.jsx("div",{className:A("p-2 rounded-full",t==="students"?"bg-white/20":"bg-primary/10 text-primary"),children:e.jsx(ne,{className:"w-6 h-6"})}),"Alunos"]}),e.jsxs(g,{variant:"outline",className:"h-24 flex flex-col gap-2",onClick:()=>s("/admin/financeiro"),children:[e.jsx("div",{className:"p-2 bg-orange-100 text-orange-600 rounded-full dark:bg-orange-900/30",children:e.jsx(it,{className:"w-6 h-6"})}),"FinanÃ§as"]}),e.jsxs(g,{variant:t==="security"?"default":"outline",className:A("h-24 flex flex-col gap-2",t==="security"&&"bg-primary text-white"),onClick:()=>{i("security"),l(!1)},children:[e.jsx("div",{className:A("p-2 rounded-full",t==="security"?"bg-white/20":"bg-red-100 text-red-600 dark:bg-red-900/30"),children:e.jsx(xe,{className:"w-6 h-6"})}),"SeguranÃ§a"]}),e.jsxs(g,{variant:t==="analytics"?"default":"outline",className:A("h-24 flex flex-col gap-2",t==="analytics"&&"bg-primary text-white"),onClick:()=>{i("analytics"),l(!1)},children:[e.jsx("div",{className:A("p-2 rounded-full",t==="analytics"?"bg-white/20":"bg-indigo-100 text-indigo-600 dark:bg-indigo-900/30"),children:e.jsx(ct,{className:"w-6 h-6"})}),"Analytics"]}),e.jsxs(g,{variant:"outline",className:"h-24 flex flex-col gap-2",onClick:()=>l(!x),children:[e.jsx("div",{className:"p-2 bg-purple-100 text-purple-600 rounded-full dark:bg-purple-900/30",children:e.jsx(ee,{className:"w-6 h-6"})}),"Logs AÃ§Ãµes"]})]})]}),t==="analytics"&&!x&&e.jsx(qt,{}),t==="security"&&!x&&e.jsx(zt,{}),!x&&t==="instructors"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Instrutores Recentes"}),e.jsxs(g,{variant:"outline",size:"sm",onClick:$,children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Atualizar"]})]}),e.jsx(w,{children:e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(L,{children:[e.jsx(R,{children:"Instrutor"}),e.jsx(R,{children:"Status"}),e.jsx(R,{children:"Data"}),e.jsx(R,{className:"text-right",children:"AÃ§Ãµes"})]})}),e.jsxs(he,{children:[u.map(d=>e.jsxs(L,{children:[e.jsxs(b,{children:[e.jsx("div",{className:"font-medium",children:d.name}),e.jsx("div",{className:"text-xs text-muted-foreground",children:d.email})]}),e.jsx(b,{children:e.jsx(I,{variant:d.status==="approved"?"default":d.status==="suspended"?"destructive":"secondary",className:d.status==="approved"?"bg-green-500 hover:bg-green-600":"",children:d.status==="approved"?"Aprovado":d.status==="suspended"?"Suspenso":"Pendente"})}),e.jsx(b,{children:new Date(d.created_at).toLocaleDateString()}),e.jsxs(b,{className:"text-right space-x-2",children:[e.jsx(g,{variant:"ghost",size:"icon",onClick:()=>k(d),children:e.jsx(ot,{className:"w-4 h-4"})}),d.status==="pending"&&e.jsxs(e.Fragment,{children:[e.jsx(g,{size:"icon",className:"h-8 w-8 bg-green-500 hover:bg-green-600",onClick:()=>Z("approve",d),children:e.jsx(ve,{className:"w-4 h-4"})}),e.jsx(g,{size:"icon",variant:"destructive",className:"h-8 w-8",onClick:()=>Z("reject",d),children:e.jsx(Ee,{className:"w-4 h-4"})})]}),d.status==="approved"&&e.jsx(g,{size:"icon",variant:"outline",className:"h-8 w-8 text-red-500 hover:text-red-700 hover:bg-red-50",onClick:()=>Z("suspend",d),children:e.jsx(Y,{className:"w-4 h-4"})})]})]},d.id)),u.length===0&&e.jsx(L,{children:e.jsx(b,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"Nenhum instrutor encontrado."})})]})]})})]}),!x&&t==="students"&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h2",{className:"text-lg font-bold",children:"Alunos Registrados"}),e.jsxs(g,{variant:"outline",size:"sm",onClick:$,children:[e.jsx(Be,{className:"w-4 h-4 mr-2"}),"Atualizar"]})]}),e.jsx(w,{children:e.jsxs(me,{children:[e.jsx(ue,{children:e.jsxs(L,{children:[e.jsx(R,{children:"Nome"}),e.jsx(R,{children:"Email"}),e.jsx(R,{children:"Data Cadastro"}),e.jsx(R,{children:"Status"})]})}),e.jsxs(he,{children:[v.map(d=>e.jsxs(L,{children:[e.jsx(b,{className:"font-medium",children:d.name||"Sem nome"}),e.jsx(b,{children:d.email||"-"}),e.jsx(b,{children:new Date(d.created_at).toLocaleDateString()}),e.jsx(b,{children:e.jsx(I,{variant:"outline",className:"bg-green-50 text-green-700 border-green-200",children:"Ativo"})})]},d.id)),v.length===0&&e.jsx(L,{children:e.jsx(b,{colSpan:4,className:"text-center py-8 text-muted-foreground",children:"Nenhum aluno encontrado."})})]})]})})]}),x&&e.jsxs(w,{children:[e.jsx(K,{children:e.jsx(V,{children:"Logs de AÃ§Ã£o"})}),e.jsx(S,{children:e.jsx("div",{className:"space-y-4",children:T.length>0?T.map(d=>{var y;return e.jsxs("div",{className:"flex items-start gap-3 pb-4 border-b last:border-0 last:pb-0",children:[e.jsx("div",{className:A("mt-1 p-2 rounded-full",d.action==="approve"?"bg-green-100 text-green-600":d.action==="reject"?"bg-red-100 text-red-600":"bg-orange-100 text-orange-600"),children:d.action==="approve"?e.jsx($e,{className:"w-4 h-4"}):d.action==="reject"?e.jsx(Y,{className:"w-4 h-4"}):e.jsx(ee,{className:"w-4 h-4"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"font-medium text-sm",children:d.action==="approve"?"Instrutor Aprovado":d.action==="reject"?"Instrutor Rejeitado":"Instrutor Suspenso"}),e.jsx("span",{className:"text-[10px] text-muted-foreground",children:new Date(d.created_at).toLocaleString("pt-BR")})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Alvo: ",e.jsx("span",{className:"font-semibold text-slate-700 dark:text-slate-300",children:((y=d.instructors)==null?void 0:y.name)||"Instrutor"})]}),d.notes&&e.jsxs("p",{className:"text-[11px] bg-slate-100 dark:bg-slate-800 p-2 rounded mt-2 italic text-slate-600 dark:text-slate-400",children:['"',d.notes,'"']})]})]},d.id)}):e.jsx("p",{className:"text-center py-4 text-muted-foreground text-sm",children:"Sem atividades registradas."})})})]})]}),e.jsx(We,{open:P,onOpenChange:_,children:e.jsxs(_e,{children:[e.jsxs(Ae,{children:[e.jsx(Ce,{children:"Aprovar Instrutor"}),e.jsxs(ke,{children:["Tem certeza que deseja aprovar ",o==null?void 0:o.name,"? Ele terÃ¡ acesso imediato Ã  plataforma."]})]}),e.jsxs(Se,{children:[e.jsx(Te,{children:"Cancelar"}),e.jsx(Re,{onClick:Le,className:"bg-green-600 hover:bg-green-700",children:"Aprovar"})]})]})}),e.jsx(We,{open:f,onOpenChange:N,children:e.jsxs(_e,{children:[e.jsxs(Ae,{children:[e.jsx(Ce,{children:"Rejeitar Instrutor"}),e.jsxs(ke,{children:["Tem certeza que deseja rejeitar ",o==null?void 0:o.name,"?"]})]}),e.jsxs(Se,{children:[e.jsx(Te,{children:"Cancelar"}),e.jsx(Re,{onClick:()=>Ie(o,"Rejeitado via diÃ¡logo padrÃ£o"),className:"bg-red-600 hover:bg-red-700",children:"Rejeitar"})]})]})}),e.jsx(Ft,{instructor:o,open:J,onClose:()=>U(!1),onConfirm:Rs}),o&&!P&&!f&&!J&&e.jsx(Mt,{instructor:o,open:!!o&&!P&&!f&&!J&&F===null,onClose:()=>k(null),onApprove:Le,onReject:Ie,onSuspend:()=>U(!0)})]})}export{ra as default};
