import{j as e}from"./supabase-vendor-zrCfvSZu.js";import{u as R,r as o,j as W}from"./react-vendor-C2tQq_zP.js";import{B as P,u as Z,s as d,h as D,c as u}from"./index-CcM7G_HG.js";import{D as H,a as K,b as J,c as Q,d as X}from"./dialog-C0xQx6hb.js";import{v as q,b as Y,a4 as A,q as ee,Z as ae,K as te,V as se,O as re,W as _,S as z,a9 as B,p as le,L as E,T as oe}from"./ui-vendor-D-xBSbyO.js";function ie({isOpen:x,onClose:h,planName:b="Novo Plano",subscription:c}){const s=R(),[f,g]=o.useState(!1);o.useEffect(()=>{if(x){const k=Date.now()+3e3,j={startVelocity:30,spread:360,ticks:60,zIndex:0},w=(i,p)=>Math.random()*(p-i)+i,C=setInterval(function(){const i=k-Date.now();if(i<=0)return clearInterval(C);const p=50*(i/3e3);q({...j,particleCount:p,origin:{x:w(.1,.3),y:Math.random()-.2}}),q({...j,particleCount:p,origin:{x:w(.7,.9),y:Math.random()-.2}})},250);return setTimeout(()=>g(!0),300),()=>clearInterval(C)}else g(!1)},[x]);const y=()=>{s("/instrutor/dashboard",{state:{refreshedSubscription:c}})};return e.jsx(H,{open:x,onOpenChange:v=>!v&&h(),children:e.jsxs(K,{className:"sm:max-w-md bg-slate-900/95 border-emerald-500/50 text-white backdrop-blur-xl shadow-2xl shadow-emerald-500/20",children:[e.jsxs(J,{className:"space-y-6 flex flex-col items-center text-center pt-6",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{className:"w-20 h-20 rounded-full bg-emerald-500/20 flex items-center justify-center animate-bounce-slow",children:e.jsx(Y,{className:"w-10 h-10 text-emerald-400",strokeWidth:3})}),e.jsx("div",{className:"absolute -top-1 -right-1",children:e.jsx(A,{className:"w-6 h-6 text-yellow-400 animate-pulse"})})]}),e.jsxs("div",{className:`space-y-2 transition-all duration-700 ${f?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:[e.jsx(Q,{className:"text-2xl font-bold bg-gradient-to-r from-white to-slate-300 bg-clip-text text-transparent",children:"Plano Ativado com Sucesso!"}),e.jsxs(X,{className:"text-slate-400 text-base",children:["Seu perfil agora tem acesso a todos os benefícios exclusivos do plano"," ",e.jsx("span",{className:"text-emerald-400 font-semibold",children:b}),"."]})]})]}),e.jsxs("div",{className:`flex flex-col gap-3 py-6 px-4 transition-all duration-1000 delay-300 ${f?"opacity-100 translate-y-0":"opacity-0 translate-y-4"}`,children:[e.jsx(P,{onClick:y,size:"lg",className:"w-full bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white font-bold shadow-lg shadow-emerald-500/25 h-12 text-lg transform transition-all hover:scale-[1.02]",children:"Ir para meu Dashboard"}),e.jsx(P,{variant:"ghost",onClick:h,className:"text-slate-500 hover:text-white hover:bg-white/10",children:"Continuar nesta página"})]})]})})}const L=[{id:"trial",name:"Trial",slug:"trial",price:0,period:"3 meses grátis",description:"Comece sua jornada na plataforma",icon:ee,color:"slate",gradient:"from-slate-500 to-slate-600",iconBg:"bg-slate-500/20",iconColor:"text-slate-400",borderColor:"border-slate-700",features:["Perfil básico na plataforma","Chat com alunos","Limite de 10 aulas/mês","Suporte por email"],highlight:!1,cta:"Seu plano atual",disabled:!0},{id:"essencial",name:"Essencial",slug:"essencial",price:79.9,period:"/mês",description:"Para instrutores comprometidos",icon:ae,color:"blue",gradient:"from-blue-500 to-blue-600",iconBg:"bg-blue-500/20",iconColor:"text-blue-400",borderColor:"border-blue-500/50",checkColor:"text-blue-400",features:["Perfil completo na plataforma","Aulas ilimitadas",'Selo "Ativo" no perfil',"Chat prioritário com alunos","Suporte por email e chat"],highlight:!1,cta:"Assinar Essencial"},{id:"destaque",name:"Destaque",slug:"destaque",price:149.9,period:"/mês",description:"Apareça para mais alunos",icon:te,color:"emerald",gradient:"from-emerald-500 to-teal-500",iconBg:"bg-emerald-500/20",iconColor:"text-emerald-400",borderColor:"border-emerald-500/50",checkColor:"text-emerald-400",features:["Tudo do Essencial","Top 10 nas buscas da sua região","Analytics de visualizações",'Badge "Destaque" no perfil',"Suporte prioritário"],highlight:!0,cta:"Assinar Destaque"},{id:"elite",name:"Elite",slug:"elite",price:249.9,period:"/mês",description:"Máxima visibilidade",icon:se,color:"amber",gradient:"from-amber-400 via-yellow-500 to-orange-500",iconBg:"bg-gradient-to-br from-amber-400/30 to-orange-500/30",iconColor:"text-amber-400",borderColor:"border-amber-500/50",checkColor:"text-amber-400",features:["Tudo do Destaque","Top 5 nas buscas da sua região",'Selo "Verificado" dourado',"Perfil com destaque visual","Suporte VIP 24h","Consultoria de perfil mensal"],highlight:!1,cta:"Assinar Elite"}];function xe(){const x=R(),[h,b]=W(),{toast:c}=Z(),[s,f]=o.useState(null),[g,y]=o.useState(!0),[v,k]=o.useState(null),[j,w]=o.useState(!1),[C,i]=o.useState(!1),[p,T]=o.useState(!1),S=o.useCallback(async()=>{var a;try{const{data:t}=await d.auth.getSession();if(!((a=t==null?void 0:t.session)!=null&&a.access_token))return y(!1),null;const{data:r,error:l}=await d.functions.invoke("check-instructor-subscription",{headers:{Authorization:`Bearer ${t.session.access_token}`}});if(l)throw l;return r!=null&&r.subscription?(f(r.subscription),r.subscription):null}catch(t){return console.error("Error checking subscription:",t),null}finally{y(!1)}},[]);o.useEffect(()=>{(async()=>{if(h.get("success")==="true"){T(!0),b({});let t=0;const r=5,l=async()=>{t++;const n=await S();if(n&&n.planType!=="trial"&&n.planType!=="expired"){T(!1),i(!0),c({title:"Plano ativado!",description:`Seu plano ${n.planType} já está ativo.`}),localStorage.removeItem("pending_plan");return}if(t<r)setTimeout(l,1e3);else{const N=localStorage.getItem("pending_plan");if(T(!1),N){console.log("Using optimistic subscription for:",N);const m={planType:N,isActive:!0,subscriptionEnd:new Date(Date.now()+720*60*60*1e3).toISOString(),daysRemaining:30};f(m),i(!0),localStorage.removeItem("pending_plan")}else i(!0)}};l()}h.get("canceled")==="true"&&(c({title:"Checkout cancelado",description:"Você pode assinar a qualquer momento.",variant:"destructive"}),b({}),localStorage.removeItem("pending_plan"))})()},[h,c,b,S]),o.useEffect(()=>{S();const a=d.channel("instructor-subscription-changes").on("postgres_changes",{event:"*",schema:"public",table:"instructor_subscriptions"},()=>{S()}).subscribe();return()=>{d.removeChannel(a)}},[]);const M=async a=>{var t;if(a!=="trial"){k(a);try{localStorage.setItem("pending_plan",a);const{data:r}=await d.auth.getSession();if(!((t=r==null?void 0:r.session)!=null&&t.access_token)){c({title:"Faça login primeiro",description:"Você precisa estar logado para assinar um plano.",variant:"destructive"}),x("/instrutor/login");return}const{data:l,error:n}=await d.functions.invoke("create-instructor-checkout",{headers:{Authorization:`Bearer ${r.session.access_token}`},body:{planType:a}});if(n)throw n;l!=null&&l.url&&(window.location.href=l.url)}catch(r){console.error("Checkout error:",r),c({title:"Erro",description:r.message||"Erro ao iniciar checkout",variant:"destructive"}),localStorage.removeItem("pending_plan")}finally{k(null)}}},V=async()=>{var a;w(!0);try{const{data:t}=await d.auth.getSession();if(!((a=t==null?void 0:t.session)!=null&&a.access_token))return;const{data:r,error:l}=await d.functions.invoke("instructor-portal",{headers:{Authorization:`Bearer ${t.session.access_token}`}});if(l)throw l;r!=null&&r.url&&(window.location.href=r.url)}catch(t){c({title:"Erro",description:t.message||"Erro ao abrir portal",variant:"destructive"})}finally{w(!1)}},$=()=>s?L.findIndex(a=>a.slug===s.planType):-1,U=a=>(s==null?void 0:s.planType)===a,F=a=>{const t=$();return t>=0&&a>t};return e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-white",children:[e.jsx("div",{className:"sticky top-0 z-50 bg-slate-900/90 backdrop-blur-xl border-b border-white/10 px-4 py-4",children:e.jsxs("div",{className:"max-w-6xl mx-auto flex items-center",children:[e.jsx("button",{onClick:()=>x(-1),className:"flex size-10 items-center justify-center rounded-full bg-white/5 hover:bg-white/10 transition-all duration-300",children:e.jsx(re,{className:"w-5 h-5"})}),e.jsx("h1",{className:"text-xl font-bold flex-1 text-center pr-10",children:"Planos para Instrutores"})]})}),e.jsxs("main",{className:"flex-1 w-full max-w-7xl mx-auto px-4 py-8",children:[p&&e.jsx("div",{className:"fixed inset-0 z-50 bg-slate-950/80 backdrop-blur-sm flex items-center justify-center",children:e.jsxs("div",{className:"bg-slate-900 border border-white/10 p-8 rounded-3xl shadow-2xl max-w-md w-full text-center space-y-6",children:[e.jsxs("div",{className:"relative w-20 h-20 mx-auto",children:[e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-emerald-500/20 animate-pulse"}),e.jsx("div",{className:"absolute inset-0 rounded-full border-4 border-t-emerald-500 animate-spin"}),e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(A,{className:"w-8 h-8 text-emerald-400 animate-pulse"})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-white mb-2",children:"Confirmando Pagamento"}),e.jsx("p",{className:"text-slate-400",children:"Estamos validando sua assinatura. Isso leva apenas alguns segundos..."})]})]})}),e.jsxs("div",{className:"text-center space-y-6 py-12",children:[(!s||s.planType==="trial")&&e.jsxs(D,{className:"bg-gradient-to-r from-amber-500/20 to-orange-500/20 text-amber-400 border-amber-500/30 px-4 py-2 text-sm font-medium",children:[e.jsx(A,{className:"w-4 h-4 mr-2 animate-pulse"}),"Oferta especial: 3 meses grátis para novos instrutores"]}),e.jsxs("h2",{className:"text-4xl md:text-5xl font-black leading-tight",children:["Invista na sua"," ",e.jsx("span",{className:"bg-gradient-to-r from-blue-400 via-emerald-400 to-amber-400 bg-clip-text text-transparent",children:"carreira"})]}),e.jsx("p",{className:"text-slate-400 max-w-lg mx-auto text-lg",children:"Escolha o plano ideal para aumentar sua visibilidade e conquistar mais alunos."}),e.jsxs("div",{className:"flex flex-wrap items-center justify-center gap-6 pt-4",children:[e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-emerald-500/20",children:e.jsx(_,{className:"w-4 h-4 text-emerald-400"})}),"Cancele quando quiser"]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-blue-500/20",children:e.jsx(z,{className:"w-4 h-4 text-blue-400"})}),"Pagamento 100% seguro"]}),e.jsxs("div",{className:"flex items-center gap-2 text-slate-400 text-sm",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-amber-500/20",children:e.jsx(B,{className:"w-4 h-4 text-amber-400"})}),"Resultados imediatos"]})]})]}),!g&&s&&e.jsx("div",{className:"mb-10 p-6 rounded-3xl bg-gradient-to-r from-blue-500/10 via-emerald-500/10 to-amber-500/10 border border-white/10 backdrop-blur-sm",children:e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-14 h-14 rounded-2xl bg-gradient-to-br from-blue-500/30 to-emerald-500/30 flex items-center justify-center",children:e.jsx(le,{className:"w-7 h-7 text-white"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-slate-400",children:"Seu plano atual"}),e.jsx("p",{className:"text-2xl font-bold capitalize",children:s.planType}),s.planType==="trial"&&s.daysRemaining&&e.jsxs("p",{className:"text-sm text-amber-400 font-medium",children:["⏱ ",s.daysRemaining," dias restantes no trial"]})]})]}),s.isActive&&s.planType!=="trial"&&e.jsxs(P,{variant:"outline",onClick:V,disabled:j,className:"border-white/20 hover:bg-white/10 hover:border-white/30 transition-all duration-300",children:[j&&e.jsx(E,{className:"w-4 h-4 animate-spin mr-2"}),"Gerenciar Assinatura"]})]})}),g&&e.jsx("div",{className:"flex justify-center py-16",children:e.jsx(E,{className:"w-10 h-10 animate-spin text-blue-400"})}),!g&&e.jsx("div",{className:"grid md:grid-cols-2 lg:grid-cols-4 gap-6",children:L.map((a,t)=>{const r=a.icon,l=U(a.slug),n=F(t),N=a.slug==="trial"||l&&(s==null?void 0:s.isActive),m=a.slug==="elite",I=a.slug==="destaque";return e.jsxs("div",{className:u("relative rounded-3xl p-6 border-2 transition-all duration-500 flex flex-col","hover:scale-[1.02] hover:-translate-y-1",a.borderColor,I&&"bg-gradient-to-b from-emerald-500/10 via-slate-900/80 to-slate-900/80 shadow-xl shadow-emerald-500/20",m&&"bg-gradient-to-b from-amber-500/15 via-slate-900/80 to-slate-900/80 shadow-xl shadow-amber-500/30",!I&&!m&&"bg-slate-900/60",l&&"ring-2 ring-offset-2 ring-offset-slate-950 ring-emerald-500"),style:{animationDelay:`${t*100}ms`},children:[I&&e.jsx("div",{className:"absolute -top-4 left-1/2 -translate-x-1/2 z-10",children:e.jsxs(D,{className:"bg-gradient-to-r from-emerald-500 to-teal-500 text-white shadow-lg shadow-emerald-500/30 px-4 py-1.5 font-bold",children:[e.jsx(oe,{className:"w-4 h-4 mr-1.5"})," Mais Popular"]})}),l&&e.jsx("div",{className:"absolute -top-3 right-4 z-10",children:e.jsx(D,{className:"bg-gradient-to-r from-emerald-500 to-green-500 text-white font-bold shadow-lg",children:"✓ Seu Plano"})}),e.jsxs("div",{className:"text-center mb-6",children:[e.jsx("div",{className:u("w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4 transition-all duration-300",a.iconBg,m&&"animate-pulse"),children:e.jsx(r,{className:u("w-8 h-8",a.iconColor)})}),e.jsx("h3",{className:u("text-2xl font-black mb-2",m&&"bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent"),children:a.name}),e.jsx("p",{className:"text-slate-500 text-sm",children:a.description})]}),e.jsx("div",{className:"text-center mb-6",children:a.price===0?e.jsxs("div",{children:[e.jsx("span",{className:"text-4xl font-black text-white",children:"Grátis"}),e.jsx("p",{className:"text-sm text-slate-400 mt-1",children:a.period})]}):e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-baseline justify-center gap-1",children:[e.jsx("span",{className:"text-lg text-slate-400",children:"R$"}),e.jsx("span",{className:u("text-4xl font-black",m?"bg-gradient-to-r from-amber-400 to-orange-500 bg-clip-text text-transparent":"text-white"),children:a.price.toFixed(2).replace(".",",")})]}),e.jsx("span",{className:"text-slate-500 text-sm",children:a.period})]})}),e.jsx("ul",{className:"space-y-3 mb-8 flex-1",children:a.features.map((O,G)=>e.jsxs("li",{className:"flex items-start gap-3 text-sm",children:[e.jsx(_,{className:u("w-5 h-5 shrink-0 mt-0.5",a.checkColor||"text-slate-400")}),e.jsx("span",{className:"text-slate-300",children:O})]},G))}),e.jsx(P,{onClick:()=>M(a.slug),disabled:N||v===a.slug,size:"lg",className:u("w-full font-bold text-base py-6 transition-all duration-300",a.slug==="trial"&&"bg-slate-700 hover:bg-slate-600 text-slate-300",a.slug==="essencial"&&"bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white shadow-lg shadow-blue-500/30",a.slug==="destaque"&&"bg-gradient-to-r from-emerald-500 to-teal-500 hover:from-emerald-600 hover:to-teal-600 text-white shadow-lg shadow-emerald-500/30",a.slug==="elite"&&"bg-gradient-to-r from-amber-400 via-yellow-500 to-orange-500 hover:from-amber-500 hover:via-yellow-600 hover:to-orange-600 text-slate-900 font-black shadow-lg shadow-amber-500/40",l&&"bg-emerald-500/20 text-emerald-400 hover:bg-emerald-500/30 shadow-none"),children:v===a.slug?e.jsx(E,{className:"w-5 h-5 animate-spin"}):l?"Plano Atual":n?e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"w-4 h-4 mr-2"}),"Upgrade para ",a.name]}):a.cta})]},a.id)})}),e.jsx("div",{className:"mt-16 text-center",children:e.jsxs("div",{className:"inline-flex flex-col items-center gap-4 p-6 rounded-2xl bg-slate-900/50 border border-white/5",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(z,{className:"w-6 h-6 text-blue-400"}),e.jsx("span",{className:"text-slate-300 font-medium",children:"Pagamento seguro via Stripe"})]}),e.jsx("p",{className:"text-slate-500 text-sm max-w-md",children:"Seus dados estão protegidos com criptografia de ponta. Você pode cancelar sua assinatura a qualquer momento sem complicações."})]})})]}),e.jsx(ie,{isOpen:C,onClose:()=>i(!1),planName:(s==null?void 0:s.planType)||"Novo Plano",subscription:s})]})}export{xe as default};
