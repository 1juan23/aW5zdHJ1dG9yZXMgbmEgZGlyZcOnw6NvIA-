import{j as e}from"./supabase-vendor-zrCfvSZu.js";import{u as _,s as i,H as F,F as C,C as P,a as R,b as Z,d as M,e as $,B as p}from"./index-CcM7G_HG.js";import{I as A}from"./input-CCzeZ9h-.js";import{L}from"./label-BuoQyU_D.js";import{T as Q}from"./TwoFactorVerify-BxhcXo2e.js";import{r as l,u as W,H as I,L as j}from"./react-vendor-C2tQq_zP.js";import{l as G,Z as J,g as K}from"./validations-BW1-a5ag.js";import{u as X,E as Y}from"./EmailSecurityBadge-Cq55aYub.js";import{g as ee,S as ae,w as se,j as re,x as te,E as ie,y as oe,L as ne}from"./ui-vendor-D-xBSbyO.js";function ge(){const[h,V]=l.useState(!1),[m,c]=l.useState(!1),[o,g]=l.useState({}),[k,v]=l.useState(!1),u=W(),{toast:n}=_(),{validateEmail:b,isValidating:N,validationResult:q,isBlocked:B,clearValidation:D}=X(),[t,w]=l.useState({email:"",password:""});l.useEffect(()=>{const{data:{subscription:s}}=i.auth.onAuthStateChange((a,r)=>{r!=null&&r.user&&setTimeout(()=>{y(r.user.id)},0)});return i.auth.getSession().then(({data:{session:a}})=>{a!=null&&a.user&&y(a.user.id)}),()=>s.unsubscribe()},[u]);const y=async s=>{const{data:a}=await i.from("user_roles").select("role").eq("user_id",s).eq("role","instructor").maybeSingle();a&&u("/instrutor/dashboard")},O=()=>{g({});try{return G.parse(t),!0}catch(s){if(s instanceof J){const a={};s.errors.forEach(r=>{r.path[0]&&(a[r.path[0].toString()]=r.message)}),g(a),n({title:"Erro de validação",description:K(s),variant:"destructive"})}return!1}},T=async s=>{var r,E;if(s.preventDefault(),!O())return;c(!0);const a=await b(t.email);if((a==null?void 0:a.status)==="BLOQUEADO"){n({title:"Email bloqueado",description:"Este email foi bloqueado por motivos de segurança. Use outro email.",variant:"destructive"}),c(!1);return}try{const{data:x,error:d}=await i.auth.signInWithPassword({email:t.email.trim(),password:t.password});if(d)throw d;if(!x.user)throw new Error("Erro ao fazer login.");const{data:f}=await i.auth.mfa.listFactors();if((r=f==null?void 0:f.totp)==null?void 0:r.some(U=>U.status==="verified")){v(!0),c(!1);return}const{data:H,error:S}=await i.from("user_roles").select("role").eq("user_id",x.user.id).eq("role","instructor").maybeSingle();if(S)throw S;if(!H){await i.auth.signOut(),n({title:"Acesso negado",description:"Esta conta não é de instrutor. Use a área de alunos.",variant:"destructive"}),c(!1);return}n({title:"Login realizado!",description:"Bem-vindo à sua área de instrutor."}),u("/instrutor/dashboard")}catch(x){let d="Ocorreu um erro. Tente novamente.";(E=x.message)!=null&&E.includes("Invalid login credentials")&&(d="Email ou senha incorretos."),n({title:"Erro",description:d,variant:"destructive"})}finally{c(!1)}},z=async()=>{n({title:"Login realizado!",description:"Verificação 2FA concluída."}),u("/instrutor/dashboard")};return k?e.jsxs(e.Fragment,{children:[e.jsx(I,{children:e.jsx("title",{children:"Verificação 2FA | Instrutores na Direção"})}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(F,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center py-12 px-4",children:e.jsx(Q,{onSuccess:z,onCancel:()=>{v(!1),i.auth.signOut()}})}),e.jsx(C,{})]})]}):e.jsxs(e.Fragment,{children:[e.jsxs(I,{children:[e.jsx("title",{children:"Área do Instrutor | Instrutores na Direção"}),e.jsx("meta",{name:"description",content:"Acesse sua área exclusiva de instrutor para gerenciar seu perfil, agenda e contatos."})]}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-gradient-to-br from-background via-background to-primary/5",children:[e.jsx(F,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center py-12 px-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8 animate-fade-in",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-20 h-20 rounded-2xl bg-gradient-to-br from-primary to-primary/80 text-primary-foreground mb-4 shadow-lg shadow-primary/20",children:e.jsx(ee,{className:"h-10 w-10"})}),e.jsxs("div",{className:"inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-accent/10 border border-accent/20 text-accent text-sm mb-4 font-medium",children:[e.jsx(ae,{className:"h-4 w-4"}),"Área do Instrutor"]}),e.jsx("h1",{className:"text-3xl font-bold text-foreground",children:"Bem-vindo, Instrutor!"}),e.jsx("p",{className:"text-muted-foreground mt-2 max-w-xs mx-auto",children:"Acesse sua área exclusiva para gerenciar seu perfil e agenda"})]}),e.jsxs(P,{variant:"elevated",className:"backdrop-blur-sm border-border/50 animate-fade-in-up",children:[e.jsxs(R,{className:"space-y-1 pb-4",children:[e.jsxs("div",{className:"flex items-center justify-center gap-2 mb-2",children:[e.jsx(se,{className:"h-5 w-5 text-green-500"}),e.jsx("span",{className:"text-xs text-green-600 font-medium",children:"Acesso Seguro"})]}),e.jsx(Z,{className:"text-xl text-center",children:"Entrar"}),e.jsx(M,{className:"text-center",children:"Use suas credenciais de instrutor"})]}),e.jsxs($,{children:[e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"email",children:"Email"}),e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(A,{id:"email",type:"email",placeholder:"instrutor@email.com",className:`pl-10 ${o.email||B?"border-destructive":""}`,value:t.email,onChange:s=>{w({...t,email:s.target.value}),D()},onBlur:()=>{t.email.includes("@")&&b(t.email)},required:!0,disabled:m||N})]}),e.jsx(Y,{isValidating:N,result:q}),o.email&&e.jsx("p",{className:"text-xs text-destructive",children:o.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"password",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx(te,{className:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground"}),e.jsx(A,{id:"password",type:h?"text":"password",placeholder:"••••••••",className:`pl-10 pr-10 ${o.password?"border-destructive":""}`,value:t.password,onChange:s=>w({...t,password:s.target.value}),required:!0,disabled:m}),e.jsx("button",{type:"button",onClick:()=>V(!h),className:"absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground hover:text-foreground",children:h?e.jsx(ie,{className:"h-4 w-4"}):e.jsx(oe,{className:"h-4 w-4"})})]}),o.password&&e.jsx("p",{className:"text-xs text-destructive",children:o.password})]}),e.jsx("div",{className:"flex items-center justify-end",children:e.jsx(j,{to:"/recuperar-senha",className:"text-sm text-accent hover:underline",children:"Esqueceu a senha?"})}),e.jsx(p,{type:"submit",size:"lg",className:"w-full",disabled:m,children:m?e.jsxs(e.Fragment,{children:[e.jsx(ne,{className:"mr-2 h-4 w-4 animate-spin"}),"Entrando..."]}):"Entrar"})]}),e.jsx("hr",{className:"my-6"}),e.jsxs("div",{className:"text-center space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Ainda não é instrutor cadastrado?"}),e.jsx(j,{to:"/instrutor/cadastro",children:e.jsx(p,{variant:"accent",className:"w-full",children:"Cadastrar como instrutor"})}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Aumente sua visibilidade e conquiste mais alunos"})]}),e.jsx("hr",{className:"my-6"}),e.jsx("div",{className:"text-center",children:e.jsx(j,{to:"/login",children:e.jsx(p,{variant:"ghost",size:"sm",className:"text-muted-foreground",children:"Sou aluno, quero entrar na área de alunos"})})})]})]})]})}),e.jsx(C,{})]})]})}export{ge as default};
