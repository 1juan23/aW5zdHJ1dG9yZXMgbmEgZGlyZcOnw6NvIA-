import{j as e}from"./supabase-vendor-zrCfvSZu.js";import{r as u}from"./react-vendor-C2tQq_zP.js";import{u as y,C as v,a as C,b as N,d as b,e as E,B as h,s}from"./index-CcM7G_HG.js";import{I as F}from"./input-CCzeZ9h-.js";import{L}from"./label-BuoQyU_D.js";import{S as V,L as D}from"./ui-vendor-D-xBSbyO.js";function A({onSuccess:p,onCancel:o}){const[a,i]=u.useState(""),[n,c]=u.useState(!1),{toast:x}=y(),g=async t=>{if(t.preventDefault(),a.length===6){c(!0);try{const{data:l,error:d}=await s.auth.mfa.listFactors();if(d)throw d;const r=l.totp.find(w=>w.status==="verified");if(!r)throw new Error("Nenhum fator 2FA configurado");const{data:j,error:m}=await s.auth.mfa.challenge({factorId:r.id});if(m)throw m;const{error:f}=await s.auth.mfa.verify({factorId:r.id,challengeId:j.id,code:a});if(f)throw f;p()}catch{x({title:"Código inválido",description:"Verifique o código e tente novamente.",variant:"destructive"}),i("")}finally{c(!1)}}};return e.jsxs(v,{className:"w-full max-w-md mx-auto",children:[e.jsxs(C,{className:"text-center",children:[e.jsx("div",{className:"mx-auto w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mb-4",children:e.jsx(V,{className:"h-6 w-6 text-primary"})}),e.jsx(N,{children:"Verificação em Duas Etapas"}),e.jsx(b,{children:"Digite o código de 6 dígitos do seu app autenticador"})]}),e.jsx(E,{children:e.jsxs("form",{onSubmit:g,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(L,{htmlFor:"code",className:"sr-only",children:"Código de verificação"}),e.jsx(F,{id:"code",type:"text",inputMode:"numeric",pattern:"[0-9]*",maxLength:6,placeholder:"000000",value:a,onChange:t=>i(t.target.value.replace(/\D/g,"")),className:"text-center text-2xl tracking-[0.5em] font-mono",autoFocus:!0,autoComplete:"one-time-code"})]}),e.jsx(h,{type:"submit",className:"w-full",disabled:n||a.length!==6,children:n?e.jsxs(e.Fragment,{children:[e.jsx(D,{className:"mr-2 h-4 w-4 animate-spin"}),"Verificando..."]}):"Verificar"}),o&&e.jsx(h,{type:"button",variant:"ghost",className:"w-full",onClick:o,children:"Voltar"})]})})]})}export{A as T};
