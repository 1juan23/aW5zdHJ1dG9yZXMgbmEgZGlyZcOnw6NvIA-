import{u as B,e as q,f as F,j as e}from"./supabase-vendor-zrCfvSZu.js";import{r as h,u as V,H as z,L as C}from"./react-vendor-C2tQq_zP.js";import{s as d,c as K,B as j,C as p,e as g,h as Q,H as L,F as k,a as P,b as D,d as I}from"./index-CcM7G_HG.js";import{D as v,p as A,L as b,s as E,U as M,q as $,X as G,O,Y as W,N as X,R as Y,M as J,m as Z}from"./ui-vendor-D-xBSbyO.js";import{I as S}from"./input-CCzeZ9h-.js";import{L as y}from"./label-BuoQyU_D.js";import{A as ee,a as se,b as ae}from"./avatar-DeTSaY0_.js";import{c as te}from"./useLessons-DS_q4MoL.js";import{C as re,D as ne}from"./CancelLessonModal-mJkGekD1.js";import{D as ie,a as le,b as oe,c as ce,d as de}from"./dialog-C0xQx6hb.js";import{T as me}from"./textarea-FnepGMth.js";import{t as ue,f as R,p as _}from"./pt-BR-XEdHDqF9.js";import{T as xe,a as he,b as H,c as T}from"./tabs-CHhfz5so.js";function fe(t){return+ue(t)<Date.now()}function je(){return B({queryKey:["profile"],queryFn:async()=>{const{data:{user:t}}=await d.auth.getUser();if(!t)throw new Error("Não autenticado");const{data:a,error:r}=await d.from("profiles").select("*").eq("user_id",t.id).maybeSingle();if(r)throw r;return a}})}function pe(){const t=q();return F({mutationFn:async a=>{const{data:{user:r}}=await d.auth.getUser();if(!r)throw new Error("Não autenticado");const{error:c}=await d.from("profiles").update(a).eq("user_id",r.id);if(c)throw c},onSuccess:()=>{t.invalidateQueries({queryKey:["profile"]}),v.success("Perfil atualizado com sucesso!")},onError:a=>{v.error(a.message||"Erro ao atualizar perfil")}})}function ge(){const t=q();return F({mutationFn:async a=>{const{data:{user:r}}=await d.auth.getUser();if(!r)throw new Error("Não autenticado");const c=a.name.split(".").pop(),o=`${r.id}/${Math.random()}.${c}`,{error:n}=await d.storage.from("avatars").upload(o,a);if(n)throw n;const{data:{publicUrl:m}}=d.storage.from("avatars").getPublicUrl(o),{error:s}=await d.from("profiles").update({avatar_url:m}).eq("user_id",r.id);if(s)throw s;return m},onSuccess:()=>{t.invalidateQueries({queryKey:["profile"]}),v.success("Foto atualizada!")},onError:a=>{v.error(a.message||"Erro ao fazer upload")}})}function Ne({lessonId:t,instructorId:a,instructorName:r,open:c,onOpenChange:o}){const[n,m]=h.useState(0),[s,x]=h.useState(0),[u,f]=h.useState(""),N=q(),i=F({mutationFn:async()=>{const{data:{user:l}}=await d.auth.getUser();if(!l)throw new Error("Não autenticado");const{error:w}=await d.from("reviews").insert({lesson_id:t,instructor_id:a,student_id:l.id,rating:n,comment:u||null});if(w)throw w},onSuccess:()=>{N.invalidateQueries({queryKey:["student-lessons"]}),N.invalidateQueries({queryKey:["reviews"]}),v.success("Avaliação enviada com sucesso!"),o(!1),m(0),f("")},onError:l=>{v.error(l.message||"Erro ao enviar avaliação")}});return e.jsx(ie,{open:c,onOpenChange:o,children:e.jsxs(le,{className:"sm:max-w-md",children:[e.jsxs(oe,{children:[e.jsxs(ce,{className:"flex items-center gap-2",children:[e.jsx(A,{className:"h-5 w-5 text-warning"}),"Avaliar Aula"]}),e.jsxs(de,{children:["Como foi sua aula com ",r,"? Sua avaliação ajuda outros alunos!"]})]}),e.jsxs("div",{className:"space-y-6 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{children:"Sua nota"}),e.jsx("div",{className:"flex gap-1 justify-center py-2",children:[1,2,3,4,5].map(l=>e.jsx("button",{type:"button",onClick:()=>m(l),onMouseEnter:()=>x(l),onMouseLeave:()=>x(0),className:"p-1 transition-transform hover:scale-110",children:e.jsx(A,{className:K("h-8 w-8 transition-colors",(s||n)>=l?"fill-warning text-warning":"text-muted-foreground")})},l))}),e.jsxs("p",{className:"text-center text-sm text-muted-foreground",children:[n===1&&"Ruim",n===2&&"Regular",n===3&&"Bom",n===4&&"Muito Bom",n===5&&"Excelente"]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"comment",children:"Comentário (opcional)"}),e.jsx(me,{id:"comment",placeholder:"Conte como foi sua experiência...",value:u,onChange:l=>f(l.target.value),rows:4})]})]}),e.jsxs("div",{className:"flex gap-3 justify-end",children:[e.jsx(j,{variant:"outline",onClick:()=>o(!1),children:"Cancelar"}),e.jsx(j,{onClick:()=>i.mutate(),disabled:i.isPending||n===0,children:i.isPending?e.jsxs(e.Fragment,{children:[e.jsx(b,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Avaliação"})]})]})})}const U={pending:{label:"Aguardando Confirmação",variant:"secondary"},confirmed:{label:"Confirmada",variant:"default"},completed:{label:"Concluída",variant:"outline"},cancelled:{label:"Cancelada",variant:"destructive"}};function ve(){const{data:t,isLoading:a}=te(),[r,c]=h.useState(null),[o,n]=h.useState(null),{data:m}=B({queryKey:["my-reviews"],queryFn:async()=>{const{data:{user:s}}=await d.auth.getUser();if(!s)return[];const{data:x,error:u}=await d.from("reviews").select("lesson_id").eq("student_id",s.id);if(u)throw u;return x.map(f=>f.lesson_id)}});return a?e.jsx("div",{className:"flex justify-center py-8",children:e.jsx(b,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):t!=null&&t.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"space-y-4",children:t.map(s=>{var i;const x=U[s.status]||U.pending,u=new Date(s.scheduled_at),f=["pending","confirmed"].includes(s.status)&&!fe(u),N=s.status==="completed"&&!(m!=null&&m.includes(s.id));return e.jsx(p,{className:"hover:shadow-md transition-shadow",children:e.jsx(g,{className:"p-4",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-start gap-4",children:[e.jsx("div",{className:"w-12 h-12 rounded-lg bg-primary/10 flex items-center justify-center shrink-0",children:e.jsx(E,{className:"h-6 w-6 text-primary"})}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx(M,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"font-medium",children:((i=s.instructor)==null?void 0:i.name)||"Instrutor"})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(E,{className:"h-3.5 w-3.5"}),e.jsx("span",{children:R(u,"d 'de' MMMM 'de' yyyy",{locale:_})})]}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx($,{className:"h-3.5 w-3.5"}),e.jsxs("span",{children:[R(u,"HH:mm",{locale:_})," - ",s.duration_minutes," min"]})]})]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx(Q,{variant:x.variant,children:x.label}),e.jsxs("span",{className:"text-lg font-bold text-primary",children:["R$ ",s.price.toFixed(2)]}),e.jsxs("div",{className:"flex gap-2 mt-2",children:[f&&e.jsxs(j,{variant:"outline",size:"sm",className:"text-destructive border-destructive hover:bg-destructive hover:text-destructive-foreground",onClick:()=>c(s.id),children:[e.jsx(G,{className:"h-4 w-4 mr-1"}),"Cancelar"]}),N&&e.jsxs(j,{variant:"outline",size:"sm",onClick:()=>{var l;return n({id:s.id,instructorId:s.instructor_id,instructorName:((l=s.instructor)==null?void 0:l.name)||"Instrutor"})},children:[e.jsx(A,{className:"h-4 w-4 mr-1"}),"Avaliar"]})]})]})]})})},s.id)})}),r&&e.jsx(re,{lessonId:r,open:!!r,onOpenChange:s=>!s&&c(null)}),o&&e.jsx(Ne,{lessonId:o.id,instructorId:o.instructorId,instructorName:o.instructorName,open:!!o,onOpenChange:s=>!s&&n(null)})]}):e.jsx(p,{children:e.jsxs(g,{className:"py-8 text-center",children:[e.jsx(E,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("p",{className:"text-muted-foreground",children:"Você ainda não tem aulas agendadas."})]})})}function De(){const t=V(),{data:a,isLoading:r}=je(),c=pe(),o=ge(),[n,m]=h.useState(""),[s,x]=h.useState(""),u=h.useRef(null);h.useEffect(()=>{d.auth.getUser().then(({data:i})=>{i.user||t("/login")})},[t]),h.useEffect(()=>{a&&(m(a.name),x(a.phone||""))},[a]);const f=async()=>{await c.mutateAsync({name:n,phone:s})},N=async i=>{var w;const l=(w=i.target.files)==null?void 0:w[0];l&&await o.mutateAsync(l)};return r?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(L,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsx(b,{className:"h-8 w-8 animate-spin text-primary"})}),e.jsx(k,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{children:[e.jsx("title",{children:"Meu Perfil | Instrutores na Direção"}),e.jsx("meta",{name:"description",content:"Gerencie seu perfil de aluno"})]}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(L,{}),e.jsxs("main",{className:"flex-1 container mx-auto px-4 py-8 max-w-4xl",children:[e.jsxs(C,{to:"/aluno/dashboard",className:"inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-primary mb-6 transition-colors",children:[e.jsx(O,{className:"h-4 w-4"}),"Voltar para o painel"]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsxs(xe,{defaultValue:"profile",className:"w-full",children:[e.jsxs(he,{className:"grid w-full grid-cols-2 mb-6",children:[e.jsxs(H,{value:"profile",className:"gap-2",children:[e.jsx(M,{className:"h-4 w-4"}),"Meu Perfil"]}),e.jsxs(H,{value:"lessons",className:"gap-2",children:[e.jsx(W,{className:"h-4 w-4"}),"Minhas Aulas"]})]}),e.jsx(T,{value:"profile",children:e.jsxs(p,{className:"border-none shadow-xl bg-card/50 backdrop-blur-sm",children:[e.jsxs(P,{className:"text-center pb-2",children:[e.jsx(D,{className:"text-2xl font-bold",children:"Meu Perfil"}),e.jsx(I,{children:"Gerencie suas informações pessoais"})]}),e.jsxs(g,{className:"space-y-6 pt-6",children:[e.jsxs("div",{className:"flex flex-col items-center gap-4",children:[e.jsxs("div",{className:"relative group",children:[e.jsxs(ee,{className:"h-28 w-28 border-4 border-background shadow-xl transition-transform group-hover:scale-105 duration-300",children:[e.jsx(se,{src:(a==null?void 0:a.avatar_url)||""}),e.jsx(ae,{className:"bg-primary/10 text-primary text-3xl",children:e.jsx(M,{className:"h-12 w-12"})})]}),e.jsx("button",{onClick:()=>{var i;return(i=u.current)==null?void 0:i.click()},className:"absolute bottom-0 right-0 p-2 bg-primary text-white rounded-full shadow-lg hover:bg-primary/90 transition-all transform hover:scale-110",children:o.isPending?e.jsx(b,{className:"h-4 w-4 animate-spin"}):e.jsx(X,{className:"h-4 w-4"})}),e.jsx("input",{type:"file",className:"hidden",ref:u,onChange:N,accept:"image/*"})]}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"Clique na câmera para alterar sua foto"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"name",className:"text-sm font-medium",children:"Nome Completo"}),e.jsx(S,{id:"name",placeholder:"Seu nome",value:n,onChange:i=>m(i.target.value),className:"h-11"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"email",className:"text-sm font-medium",children:"E-mail"}),e.jsx(S,{id:"email",value:(a==null?void 0:a.email)||"",disabled:!0,className:"h-11 bg-muted/50"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"O e-mail não pode ser alterado"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(y,{htmlFor:"phone",className:"text-sm font-medium",children:"Telefone / WhatsApp"}),e.jsx(S,{id:"phone",placeholder:"(00) 00000-0000",value:s,onChange:i=>x(i.target.value),className:"h-11"})]}),e.jsxs(j,{onClick:f,disabled:c.isPending,className:"w-full h-12 font-semibold gap-2",children:[c.isPending?e.jsx(b,{className:"h-5 w-5 animate-spin"}):e.jsx(Y,{className:"h-5 w-5"}),"Salvar Alterações"]})]}),e.jsx(ne,{userType:"student"})]})]})}),e.jsx(T,{value:"lessons",children:e.jsxs(p,{className:"border-none shadow-xl bg-card/50 backdrop-blur-sm",children:[e.jsxs(P,{className:"pb-2",children:[e.jsx(D,{className:"text-2xl font-bold",children:"Histórico de Aulas"}),e.jsx(I,{children:"Veja todas as suas aulas agendadas"})]}),e.jsx(g,{className:"pt-6",children:e.jsx(ve,{})})]})})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(p,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-primary/10 flex items-center justify-center mb-4",children:e.jsx(J,{className:"h-6 w-6 text-primary"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"Mensagens"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Converse com seus instrutores"}),e.jsx(C,{to:"/mensagens",children:e.jsx(j,{variant:"outline",className:"w-full",children:"Ver Mensagens"})})]})}),e.jsx(p,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-accent/10 flex items-center justify-center mb-4",children:e.jsx(E,{className:"h-6 w-6 text-accent"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"Minhas Aulas"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Veja suas aulas agendadas"}),e.jsx(C,{to:"/aluno/dashboard",children:e.jsx(j,{variant:"outline",className:"w-full",children:"Ver Aulas"})})]})}),e.jsx(p,{className:"hover:shadow-lg transition-shadow",children:e.jsxs(g,{className:"p-6",children:[e.jsx("div",{className:"w-12 h-12 rounded-xl bg-warning/10 flex items-center justify-center mb-4",children:e.jsx(Z,{className:"h-6 w-6 text-warning"})}),e.jsx("h3",{className:"font-semibold mb-2",children:"Buscar Instrutores"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Encontre novos instrutores"}),e.jsx(C,{to:"/instrutores",children:e.jsx(j,{variant:"outline",className:"w-full",children:"Buscar"})})]})})]})]})]}),e.jsx(k,{})]})]})}export{De as default};
