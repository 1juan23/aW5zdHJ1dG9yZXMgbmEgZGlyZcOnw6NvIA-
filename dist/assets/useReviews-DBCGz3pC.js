import{u as l,e as m,f}from"./supabase-vendor-zrCfvSZu.js";import{s as o}from"./index-CcM7G_HG.js";import{D as c}from"./ui-vendor-D-xBSbyO.js";function y(t){return l({queryKey:["reviews",t],queryFn:async()=>{const{data:e,error:a}=await o.from("reviews").select("*").eq("instructor_id",t).order("created_at",{ascending:!1});if(a)throw a;if(!e||e.length===0)return[];const s=[...new Set(e.map(r=>r.student_id))],{data:n}=await o.from("profiles").select("user_id, name, avatar_url").in("user_id",s),u=new Map((n||[]).map(r=>[r.user_id,r]));return e.map(r=>{var d,i;return{...r,student_name:((d=u.get(r.student_id))==null?void 0:d.name)||"Aluno",student_avatar:((i=u.get(r.student_id))==null?void 0:i.avatar_url)||null}})},enabled:!!t})}function _(){const t=m();return f({mutationFn:async({lessonId:e,instructorId:a,rating:s,comment:n,photos:u})=>{const{data:{user:r}}=await o.auth.getUser();if(!r)throw new Error("Não autenticado");const{data:d,error:i}=await o.from("reviews").insert({lesson_id:e,instructor_id:a,student_id:r.id,rating:s,comment:n,photos:u}).select().single();if(i)throw i;return d},onSuccess:(e,a)=>{t.invalidateQueries({queryKey:["reviews",a.instructorId]}),t.invalidateQueries({queryKey:["instructor",a.instructorId]}),t.invalidateQueries({queryKey:["student-lessons"]}),c.success("Avaliação enviada com sucesso!")},onError:e=>{c.error(e.message||"Erro ao enviar avaliação")}})}async function g(t){const e=t.name.split(".").pop(),a=`${crypto.randomUUID()}.${e}`,{error:s}=await o.storage.from("review-photos").upload(a,t);if(s)throw s;const{data:n}=o.storage.from("review-photos").getPublicUrl(a);return n.publicUrl}export{_ as a,g as b,y as u};
