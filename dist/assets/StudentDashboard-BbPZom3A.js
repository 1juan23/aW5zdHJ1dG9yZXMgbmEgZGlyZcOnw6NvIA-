import{j as e,u as q}from"./supabase-vendor-zrCfvSZu.js";import{r as N,u as T,H as G,L as F}from"./react-vendor-C2tQq_zP.js";import{B as g,s as U,H as P,F as S,C as x,e as u,h as C}from"./index-CcM7G_HG.js";import{T as J,a as K,b,c as w}from"./tabs-CHhfz5so.js";import{D as Q,i as V,a as X,b as O,c as W}from"./dialog-C0xQx6hb.js";import{c as Y}from"./useLessons-DS_q4MoL.js";import{T as Z}from"./textarea-FnepGMth.js";import{L as R}from"./label-BuoQyU_D.js";import{a as ee,b as se}from"./useReviews-DBCGz3pC.js";import{p as k,X as ae,L,al as te,M as _,H as A,U as re,s as M,q as ne,J as H,n as le,k as ie}from"./ui-vendor-D-xBSbyO.js";import{u as ce,F as de}from"./FavoriteButton-BENyxh-m.js";import{f as I,p as D}from"./pt-BR-XEdHDqF9.js";function oe({lessonId:p,instructorId:a,onSuccess:c}){const[d,t]=N.useState(0),[h,f]=N.useState(0),[s,o]=N.useState(""),[n,l]=N.useState([]),[i,j]=N.useState(!1),E=ee(),B=async r=>{const m=r.target.files;if(m!=null&&m.length){j(!0);try{const y=await Promise.all(Array.from(m).map(v=>se(v)));l(v=>[...v,...y])}catch(y){console.error("Error uploading photos:",y)}finally{j(!1)}}},$=r=>{l(m=>m.filter((y,v)=>v!==r))},z=async r=>{r.preventDefault(),d!==0&&(await E.mutateAsync({lessonId:p,instructorId:a,rating:d,comment:s,photos:n}),c==null||c())};return e.jsxs("form",{onSubmit:z,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx(R,{className:"mb-2 block",children:"Sua avaliação"}),e.jsx("div",{className:"flex gap-1",children:[1,2,3,4,5].map(r=>e.jsx("button",{type:"button",onClick:()=>t(r),onMouseEnter:()=>f(r),onMouseLeave:()=>f(0),className:"p-1 transition-transform hover:scale-110",children:e.jsx(k,{className:`h-8 w-8 ${r<=(h||d)?"fill-warning text-warning":"text-muted-foreground"}`})},r))})]}),e.jsxs("div",{children:[e.jsx(R,{htmlFor:"comment",children:"Comentário (opcional)"}),e.jsx(Z,{id:"comment",value:s,onChange:r=>o(r.target.value),placeholder:"Conte como foi sua experiência...",className:"mt-2",rows:4})]}),e.jsxs("div",{children:[e.jsx(R,{children:"Fotos (opcional)"}),e.jsxs("div",{className:"mt-2 flex flex-wrap gap-3",children:[n.map((r,m)=>e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:r,alt:`Foto ${m+1}`,className:"h-20 w-20 rounded-lg object-cover"}),e.jsx("button",{type:"button",onClick:()=>$(m),className:"absolute -right-2 -top-2 rounded-full bg-destructive p-1 text-destructive-foreground",children:e.jsx(ae,{className:"h-3 w-3"})})]},m)),e.jsxs("label",{className:"flex h-20 w-20 cursor-pointer items-center justify-center rounded-lg border-2 border-dashed border-muted-foreground/25 hover:border-muted-foreground/50 transition-colors",children:[e.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:B,className:"hidden",disabled:i}),i?e.jsx(L,{className:"h-6 w-6 animate-spin text-muted-foreground"}):e.jsx(te,{className:"h-6 w-6 text-muted-foreground"})]})]})]}),e.jsx(g,{type:"submit",disabled:d===0||E.isPending,className:"w-full",children:E.isPending?e.jsxs(e.Fragment,{children:[e.jsx(L,{className:"mr-2 h-4 w-4 animate-spin"}),"Enviando..."]}):"Enviar Avaliação"})]})}function Ce(){const p=T(),{data:a,isLoading:c}=Y();N.useEffect(()=>{U.auth.getUser().then(({data:s})=>{s.user||p("/login")})},[p]);const d=(a==null?void 0:a.filter(s=>s.status==="pending"||s.status==="confirmed"))||[],t=(a==null?void 0:a.filter(s=>s.status==="completed"))||[],h=(a==null?void 0:a.filter(s=>s.status==="cancelled"))||[],f=s=>{switch(s){case"pending":return e.jsx(C,{variant:"secondary",children:"Pendente"});case"confirmed":return e.jsx(C,{className:"bg-accent text-accent-foreground",children:"Confirmada"});case"completed":return e.jsx(C,{variant:"default",children:"Concluída"});case"cancelled":return e.jsx(C,{variant:"destructive",children:"Cancelada"});default:return null}};return c?e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(P,{}),e.jsx("main",{className:"flex-1 flex items-center justify-center",children:e.jsx(L,{className:"h-8 w-8 animate-spin text-muted-foreground"})}),e.jsx(S,{})]}):e.jsxs(e.Fragment,{children:[e.jsxs(G,{children:[e.jsx("title",{children:"Minhas Aulas | Instrutores na Direção"}),e.jsx("meta",{name:"description",content:"Gerencie suas aulas agendadas"})]}),e.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[e.jsx(P,{}),e.jsxs("main",{className:"flex-1 container mx-auto px-4 py-8",children:[e.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Minhas Aulas"}),e.jsxs(J,{defaultValue:"upcoming",className:"space-y-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center justify-between gap-4",children:[e.jsxs(K,{className:"bg-slate-100/50 p-1 rounded-xl",children:[e.jsxs(b,{value:"upcoming",children:["Próximas (",d.length,")"]}),e.jsxs(b,{value:"completed",children:["Concluídas (",t.length,")"]}),e.jsxs(b,{value:"cancelled",children:["Canceladas (",h.length,")"]}),e.jsxs(b,{value:"messages",className:"gap-2",children:[e.jsx(_,{className:"h-4 w-4"}),"Mensagens"]}),e.jsxs(b,{value:"favorites",className:"gap-2",children:[e.jsx(A,{className:"h-4 w-4"}),"Favoritos"]})]}),e.jsx(F,{to:"/aluno/perfil",children:e.jsxs(g,{variant:"outline",size:"sm",className:"gap-2 border-primary/20 hover:bg-primary/5 hover:border-primary transition-all",children:[e.jsx(re,{className:"h-4 w-4 text-primary"}),"Meu Perfil"]})})]}),e.jsx(w,{value:"upcoming",className:"space-y-4",children:d.length>0?d.map(s=>{var o,n,l,i,j;return e.jsx(x,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:((o=s.instructor)==null?void 0:o.avatar_url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((n=s.instructor)==null?void 0:n.name)||"I")}&size=64`,alt:(l=s.instructor)==null?void 0:l.name,className:"w-16 h-16 rounded-xl object-cover bg-muted"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:(i=s.instructor)==null?void 0:i.name}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(M,{className:"h-4 w-4"}),I(new Date(s.scheduled_at),"EEEE, d 'de' MMMM",{locale:D})]}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(ne,{className:"h-4 w-4"}),I(new Date(s.scheduled_at),"HH:mm")]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[f(s.status),e.jsxs("p",{className:"font-bold text-lg",children:["R$ ",(j=s.price)==null?void 0:j.toFixed(2)]}),e.jsx(F,{to:"/mensagens",children:e.jsx(g,{size:"icon",variant:"ghost",className:"text-primary hover:text-primary-light",children:e.jsx(H,{className:"h-5 w-5"})})})]})]})})},s.id)}):e.jsx(x,{children:e.jsxs(u,{className:"p-12 text-center",children:[e.jsx(M,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Nenhuma aula agendada"}),e.jsx("p",{className:"text-muted-foreground mb-4",children:"Encontre um instrutor e agende sua primeira aula"}),e.jsx(g,{onClick:()=>p("/instrutores"),children:"Buscar Instrutores"})]})})}),e.jsx(w,{value:"completed",className:"space-y-4",children:t.length>0?t.map(s=>{var o,n,l,i,j;return e.jsx(x,{children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:((o=s.instructor)==null?void 0:o.avatar_url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((n=s.instructor)==null?void 0:n.name)||"I")}&size=64`,alt:(l=s.instructor)==null?void 0:l.name,className:"w-16 h-16 rounded-xl object-cover bg-muted"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:(i=s.instructor)==null?void 0:i.name}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(M,{className:"h-4 w-4"}),I(new Date(s.scheduled_at),"d 'de' MMMM 'de' yyyy",{locale:D})]})]})]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs(Q,{children:[e.jsx(V,{asChild:!0,children:e.jsxs(g,{variant:"outline",className:"gap-2",children:[e.jsx(k,{className:"h-4 w-4"}),"Avaliar"]})}),e.jsxs(X,{children:[e.jsx(O,{children:e.jsxs(W,{children:["Avaliar aula com ",(j=s.instructor)==null?void 0:j.name]})}),e.jsx(oe,{lessonId:s.id,instructorId:s.instructor_id})]})]}),f(s.status)]})]})})},s.id)}):e.jsx(x,{children:e.jsxs(u,{className:"p-12 text-center",children:[e.jsx(le,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Nenhuma aula concluída"}),e.jsx("p",{className:"text-muted-foreground",children:"Suas aulas concluídas aparecerão aqui"})]})})}),e.jsx(w,{value:"cancelled",className:"space-y-4",children:h.length>0?h.map(s=>{var o,n,l,i;return e.jsx(x,{className:"opacity-75",children:e.jsx(u,{className:"p-6",children:e.jsxs("div",{className:"flex flex-wrap items-center justify-between gap-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:((o=s.instructor)==null?void 0:o.avatar_url)||`https://ui-avatars.com/api/?name=${encodeURIComponent(((n=s.instructor)==null?void 0:n.name)||"I")}&size=64`,alt:(l=s.instructor)==null?void 0:l.name,className:"w-16 h-16 rounded-xl object-cover bg-muted"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold text-lg",children:(i=s.instructor)==null?void 0:i.name}),e.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground",children:[e.jsx(M,{className:"h-4 w-4"}),I(new Date(s.scheduled_at),"d 'de' MMMM 'de' yyyy",{locale:D})]})]})]}),f(s.status)]})})},s.id)}):e.jsx(x,{children:e.jsx(u,{className:"p-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"Nenhuma aula cancelada"})})})}),e.jsx(w,{value:"messages",className:"space-y-4",children:e.jsx(x,{children:e.jsxs(u,{className:"p-12 text-center",children:[e.jsx(_,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Suas conversas"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Acesse suas mensagens e combine os detalhes das suas aulas."}),e.jsx(F,{to:"/mensagens",children:e.jsxs(g,{className:"gap-2",children:[e.jsx(H,{className:"h-5 w-5"}),"Ir para Mensagens"]})})]})})}),e.jsx(w,{value:"favorites",className:"space-y-4",children:e.jsx(me,{})})]})]}),e.jsx(S,{})]})]})}function me(){const p=T(),{data:a}=ce(),{data:c,isLoading:d}=q({queryKey:["favorite-instructors",a],queryFn:async()=>{if(!a||a.length===0)return[];const{data:t,error:h}=await U.from("instructors_public").select("*").in("id",a);if(h)throw h;return t},enabled:!!a&&a.length>0});return d?e.jsx("div",{className:"text-center py-8",children:e.jsx(L,{className:"h-8 w-8 animate-spin mx-auto text-muted-foreground"})}):c!=null&&c.length?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:c.map(t=>e.jsx(F,{to:`/instrutor/${t.id}`,children:e.jsx(x,{className:"h-full hover:shadow-md transition-shadow cursor-pointer group",children:e.jsx(u,{className:"p-0",children:e.jsxs("div",{className:"flex gap-4 p-4",children:[e.jsx("img",{src:t.avatar_url||`https://ui-avatars.com/api/?name=${encodeURIComponent(t.name||"I")}&size=96`,alt:t.name||"Instrutor",className:"w-20 h-20 rounded-xl object-cover bg-muted group-hover:scale-105 transition-transform"}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx("h3",{className:"font-semibold truncate",children:t.name}),e.jsx(de,{instructorId:t.id||"",size:"sm",className:"h-8 w-8"})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm text-muted-foreground mt-1",children:[e.jsx(ie,{className:"h-3 w-3"}),e.jsxs("span",{children:[t.city,", ",t.state]})]}),e.jsxs("div",{className:"flex items-center gap-1 text-sm mt-1",children:[e.jsx(k,{className:"h-3 w-3 fill-amber-400 text-amber-400"}),e.jsx("span",{className:"font-medium",children:t.rating||0})]})]})]})})})},t.id))}):e.jsx(x,{children:e.jsxs(u,{className:"p-12 text-center",children:[e.jsx(A,{className:"h-12 w-12 mx-auto mb-4 text-muted-foreground"}),e.jsx("h3",{className:"font-medium text-lg mb-2",children:"Nenhum favorito ainda"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"Explore nossos instrutores e salve seus favoritos aqui."}),e.jsx(g,{onClick:()=>p("/instrutores"),children:"Encontrar Instrutores"})]})})}export{Ce as default};
