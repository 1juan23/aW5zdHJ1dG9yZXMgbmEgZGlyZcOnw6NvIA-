import{u as o,e as y,f}from"./supabase-vendor-zrCfvSZu.js";import{s}from"./index-CcM7G_HG.js";import{D as d}from"./ui-vendor-D-xBSbyO.js";function h(){return o({queryKey:["student-lessons"],queryFn:async()=>{const{data:{user:e}}=await s.auth.getUser();if(!e)throw new Error("Não autenticado");const{data:t,error:r}=await s.from("lessons").select(`
          *,
          instructor:instructors_public (name, avatar_url)
        `).eq("student_id",e.id).order("scheduled_at",{ascending:!0});if(r)throw r;return t}})}function q(){return o({queryKey:["instructor-lessons"],queryFn:async()=>{const{data:{user:e}}=await s.auth.getUser();if(!e)throw new Error("Não autenticado");const{data:t}=await s.from("instructors").select("id").eq("user_id",e.id).maybeSingle();if(!t)return[];const{data:r,error:n}=await s.from("lessons").select("*").eq("instructor_id",t.id).order("scheduled_at",{ascending:!0});if(n)throw n;return await Promise.all((r||[]).map(async u=>{const{data:a}=await s.from("profiles_public").select("name, avatar_url").eq("user_id",u.student_id).maybeSingle();return{...u,student:a&&a.name?a:{name:"Aluno",avatar_url:null}}}))}})}function g(e){return o({queryKey:["availability",e],queryFn:async()=>{const{data:t,error:r}=await s.from("availability_slots").select("*").eq("instructor_id",e).eq("is_active",!0).order("day_of_week",{ascending:!0});if(r)throw r;return t},enabled:!!e})}function b(){const e=y();return f({mutationFn:async({instructorId:t,scheduledAt:r,durationMinutes:n,price:i,notes:u})=>{const{data:{user:a}}=await s.auth.getUser();if(!a)throw new Error("Não autenticado");const{data:l,error:c}=await s.from("lessons").insert({instructor_id:t,student_id:a.id,scheduled_at:r.toISOString(),duration_minutes:n,price:i,status:"pending",notes:u||null}).select().single();if(c)throw c;return l},onSuccess:()=>{e.invalidateQueries({queryKey:["student-lessons"]}),e.invalidateQueries({queryKey:["instructor-lessons"]}),d.success("Aula agendada com sucesso!")},onError:t=>{d.error(t.message||"Erro ao agendar aula")}})}export{b as a,q as b,h as c,g as u};
