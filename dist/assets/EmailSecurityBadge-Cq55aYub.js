import{r as o}from"./react-vendor-C2tQq_zP.js";import{u as x,s as f,T as g,p,q as h,r as b}from"./index-CcM7G_HG.js";import{j as e}from"./supabase-vendor-zrCfvSZu.js";import{L as j,S as E,aa as v,ab as C,w as S}from"./ui-vendor-D-xBSbyO.js";function A(){const[l,a]=o.useState(!1),[s,t]=o.useState(null),{toast:r}=x(),n=o.useCallback(async d=>{if(!d||!d.includes("@"))return null;a(!0);try{const{data:u,error:m}=await f.functions.invoke("validate-email-security",{body:{email:d.trim().toLowerCase()}});if(m)return console.error("Email validation error:",m),null;const i=u;return t(i),i.status==="BLOQUEADO"?r({title:"Email bloqueado",description:i.motivos.join(". "),variant:"destructive"}):i.status==="DESAFIO"&&r({title:"Verificação adicional necessária",description:"Por segurança, uma verificação extra será solicitada.",variant:"default"}),i}catch(u){return console.error("Email validation failed:",u),null}finally{a(!1)}},[r]),c=o.useCallback(()=>{t(null)},[]);return{validateEmail:n,isValidating:l,validationResult:s,requiresChallenge:(s==null?void 0:s.status)==="DESAFIO",isBlocked:(s==null?void 0:s.status)==="BLOQUEADO",clearValidation:c}}function D({isValidating:l,result:a}){if(l)return e.jsxs("div",{className:"flex items-center gap-1.5 text-muted-foreground text-xs",children:[e.jsx(j,{className:"h-3.5 w-3.5 animate-spin"}),e.jsx("span",{children:"Verificando segurança..."})]});if(!a)return null;const t=(()=>{switch(a.status){case"PERMITIDO":return{icon:S,color:"text-green-500",bgColor:"bg-green-500/10",label:"Email verificado"};case"DESAFIO":return{icon:C,color:"text-amber-500",bgColor:"bg-amber-500/10",label:"Verificação adicional"};case"BLOQUEADO":return{icon:v,color:"text-destructive",bgColor:"bg-destructive/10",label:"Email bloqueado"};default:return{icon:E,color:"text-muted-foreground",bgColor:"bg-muted",label:"Verificando..."}}})(),r=t.icon;return e.jsx(g,{children:e.jsxs(p,{children:[e.jsx(h,{asChild:!0,children:e.jsxs("div",{className:`flex items-center gap-1.5 text-xs ${t.color} cursor-help`,children:[e.jsx("div",{className:`p-0.5 rounded ${t.bgColor}`,children:e.jsx(r,{className:"h-3.5 w-3.5"})}),e.jsx("span",{children:t.label})]})}),e.jsx(b,{side:"bottom",className:"max-w-xs",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"font-medium",children:["Score de risco: ",a.score_risco,"/100"]}),e.jsx("ul",{className:"text-xs space-y-1",children:a.motivos.map((n,c)=>e.jsxs("li",{className:"flex items-start gap-1",children:[e.jsx("span",{className:"text-muted-foreground",children:"•"}),e.jsx("span",{children:n})]},c))}),a.status==="BLOQUEADO"&&e.jsx("p",{className:"text-xs text-destructive font-medium mt-2",children:a.acao_recomendada})]})})]})})}export{D as E,A as u};
