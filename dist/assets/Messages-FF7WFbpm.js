import{j as r}from"./supabase-vendor-zrCfvSZu.js";import{r as l,j as we,u as je,H as Ce}from"./react-vendor-C2tQq_zP.js";import{k as R,w as Pe,m as ye,P as A,S as z,n as P,E as C,z as Ee,c as M,s as ee,B as Re,H as $,F as J,C as G}from"./index-CcM7G_HG.js";import{A as re,a as te,b as oe}from"./avatar-DeTSaY0_.js";import{c as Ne}from"./index-BdQq_4o_.js";import{I as Ae}from"./input-CCzeZ9h-.js";import{a as Te,b as _e,c as Le}from"./useMessages-BNsuwQIj.js";import{L as Y,ak as De,D as K,J as Q}from"./ui-vendor-D-xBSbyO.js";import{f as ne,p as se}from"./pt-BR-XEdHDqF9.js";function He(e,o){return l.useReducer((t,s)=>o[t][s]??t,e)}var B="ScrollArea",[le]=ye(B),[Me,v]=le(B),ae=l.forwardRef((e,o)=>{const{__scopeScrollArea:t,type:s="hover",dir:n,scrollHideDelay:c=600,...a}=e,[d,u]=l.useState(null),[m,i]=l.useState(null),[f,h]=l.useState(null),[b,x]=l.useState(null),[w,k]=l.useState(null),[j,T]=l.useState(0),[X,_]=l.useState(0),[L,N]=l.useState(!1),[D,H]=l.useState(!1),p=R(o,y=>u(y)),g=Pe(n);return r.jsx(Me,{scope:t,type:s,dir:g,scrollHideDelay:c,scrollArea:d,viewport:m,onViewportChange:i,content:f,onContentChange:h,scrollbarX:b,onScrollbarXChange:x,scrollbarXEnabled:L,onScrollbarXEnabledChange:N,scrollbarY:w,onScrollbarYChange:k,scrollbarYEnabled:D,onScrollbarYEnabledChange:H,onCornerWidthChange:T,onCornerHeightChange:_,children:r.jsx(A.div,{dir:g,...a,ref:p,style:{position:"relative","--radix-scroll-area-corner-width":j+"px","--radix-scroll-area-corner-height":X+"px",...e.style}})})});ae.displayName=B;var ce="ScrollAreaViewport",ie=l.forwardRef((e,o)=>{const{__scopeScrollArea:t,children:s,nonce:n,...c}=e,a=v(ce,t),d=l.useRef(null),u=R(o,d,a.onViewportChange);return r.jsxs(r.Fragment,{children:[r.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:n}),r.jsx(A.div,{"data-radix-scroll-area-viewport":"",...c,ref:u,style:{overflowX:a.scrollbarXEnabled?"scroll":"hidden",overflowY:a.scrollbarYEnabled?"scroll":"hidden",...e.style},children:r.jsx("div",{ref:a.onContentChange,style:{minWidth:"100%",display:"table"},children:s})})]})});ie.displayName=ce;var S="ScrollAreaScrollbar",F=l.forwardRef((e,o)=>{const{forceMount:t,...s}=e,n=v(S,e.__scopeScrollArea),{onScrollbarXEnabledChange:c,onScrollbarYEnabledChange:a}=n,d=e.orientation==="horizontal";return l.useEffect(()=>(d?c(!0):a(!0),()=>{d?c(!1):a(!1)}),[d,c,a]),n.type==="hover"?r.jsx(We,{...s,ref:o,forceMount:t}):n.type==="scroll"?r.jsx(Ie,{...s,ref:o,forceMount:t}):n.type==="auto"?r.jsx(de,{...s,ref:o,forceMount:t}):n.type==="always"?r.jsx(V,{...s,ref:o}):null});F.displayName=S;var We=l.forwardRef((e,o)=>{const{forceMount:t,...s}=e,n=v(S,e.__scopeScrollArea),[c,a]=l.useState(!1);return l.useEffect(()=>{const d=n.scrollArea;let u=0;if(d){const m=()=>{window.clearTimeout(u),a(!0)},i=()=>{u=window.setTimeout(()=>a(!1),n.scrollHideDelay)};return d.addEventListener("pointerenter",m),d.addEventListener("pointerleave",i),()=>{window.clearTimeout(u),d.removeEventListener("pointerenter",m),d.removeEventListener("pointerleave",i)}}},[n.scrollArea,n.scrollHideDelay]),r.jsx(z,{present:t||c,children:r.jsx(de,{"data-state":c?"visible":"hidden",...s,ref:o})})}),Ie=l.forwardRef((e,o)=>{const{forceMount:t,...s}=e,n=v(S,e.__scopeScrollArea),c=e.orientation==="horizontal",a=U(()=>u("SCROLL_END"),100),[d,u]=He("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return l.useEffect(()=>{if(d==="idle"){const m=window.setTimeout(()=>u("HIDE"),n.scrollHideDelay);return()=>window.clearTimeout(m)}},[d,n.scrollHideDelay,u]),l.useEffect(()=>{const m=n.viewport,i=c?"scrollLeft":"scrollTop";if(m){let f=m[i];const h=()=>{const b=m[i];f!==b&&(u("SCROLL"),a()),f=b};return m.addEventListener("scroll",h),()=>m.removeEventListener("scroll",h)}},[n.viewport,c,u,a]),r.jsx(z,{present:t||d!=="hidden",children:r.jsx(V,{"data-state":d==="hidden"?"hidden":"visible",...s,ref:o,onPointerEnter:P(e.onPointerEnter,()=>u("POINTER_ENTER")),onPointerLeave:P(e.onPointerLeave,()=>u("POINTER_LEAVE"))})})}),de=l.forwardRef((e,o)=>{const t=v(S,e.__scopeScrollArea),{forceMount:s,...n}=e,[c,a]=l.useState(!1),d=e.orientation==="horizontal",u=U(()=>{if(t.viewport){const m=t.viewport.offsetWidth<t.viewport.scrollWidth,i=t.viewport.offsetHeight<t.viewport.scrollHeight;a(d?m:i)}},10);return E(t.viewport,u),E(t.content,u),r.jsx(z,{present:s||c,children:r.jsx(V,{"data-state":c?"visible":"hidden",...n,ref:o})})}),V=l.forwardRef((e,o)=>{const{orientation:t="vertical",...s}=e,n=v(S,e.__scopeScrollArea),c=l.useRef(null),a=l.useRef(0),[d,u]=l.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),m=be(d.viewport,d.content),i={...s,sizes:d,onSizesChange:u,hasThumb:m>0&&m<1,onThumbChange:h=>c.current=h,onThumbPointerUp:()=>a.current=0,onThumbPointerDown:h=>a.current=h};function f(h,b){return Ye(h,a.current,d,b)}return t==="horizontal"?r.jsx(ze,{...i,ref:o,onThumbPositionChange:()=>{if(n.viewport&&c.current){const h=n.viewport.scrollLeft,b=Z(h,d,n.dir);c.current.style.transform=`translate3d(${b}px, 0, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollLeft=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollLeft=f(h,n.dir))}}):t==="vertical"?r.jsx(Oe,{...i,ref:o,onThumbPositionChange:()=>{if(n.viewport&&c.current){const h=n.viewport.scrollTop,b=Z(h,d);c.current.style.transform=`translate3d(0, ${b}px, 0)`}},onWheelScroll:h=>{n.viewport&&(n.viewport.scrollTop=h)},onDragScroll:h=>{n.viewport&&(n.viewport.scrollTop=f(h))}}):null}),ze=l.forwardRef((e,o)=>{const{sizes:t,onSizesChange:s,...n}=e,c=v(S,e.__scopeScrollArea),[a,d]=l.useState(),u=l.useRef(null),m=R(o,u,c.onScrollbarXChange);return l.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),r.jsx(fe,{"data-orientation":"horizontal",...n,ref:m,sizes:t,style:{bottom:0,left:c.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:c.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":O(t)+"px",...e.style},onThumbPointerDown:i=>e.onThumbPointerDown(i.x),onDragScroll:i=>e.onDragScroll(i.x),onWheelScroll:(i,f)=>{if(c.viewport){const h=c.viewport.scrollLeft+i.deltaX;e.onWheelScroll(h),xe(h,f)&&i.preventDefault()}},onResize:()=>{u.current&&c.viewport&&a&&s({content:c.viewport.scrollWidth,viewport:c.viewport.offsetWidth,scrollbar:{size:u.current.clientWidth,paddingStart:I(a.paddingLeft),paddingEnd:I(a.paddingRight)}})}})}),Oe=l.forwardRef((e,o)=>{const{sizes:t,onSizesChange:s,...n}=e,c=v(S,e.__scopeScrollArea),[a,d]=l.useState(),u=l.useRef(null),m=R(o,u,c.onScrollbarYChange);return l.useEffect(()=>{u.current&&d(getComputedStyle(u.current))},[u]),r.jsx(fe,{"data-orientation":"vertical",...n,ref:m,sizes:t,style:{top:0,right:c.dir==="ltr"?0:void 0,left:c.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":O(t)+"px",...e.style},onThumbPointerDown:i=>e.onThumbPointerDown(i.y),onDragScroll:i=>e.onDragScroll(i.y),onWheelScroll:(i,f)=>{if(c.viewport){const h=c.viewport.scrollTop+i.deltaY;e.onWheelScroll(h),xe(h,f)&&i.preventDefault()}},onResize:()=>{u.current&&c.viewport&&a&&s({content:c.viewport.scrollHeight,viewport:c.viewport.offsetHeight,scrollbar:{size:u.current.clientHeight,paddingStart:I(a.paddingTop),paddingEnd:I(a.paddingBottom)}})}})}),[Ue,ue]=le(S),fe=l.forwardRef((e,o)=>{const{__scopeScrollArea:t,sizes:s,hasThumb:n,onThumbChange:c,onThumbPointerUp:a,onThumbPointerDown:d,onThumbPositionChange:u,onDragScroll:m,onWheelScroll:i,onResize:f,...h}=e,b=v(S,t),[x,w]=l.useState(null),k=R(o,p=>w(p)),j=l.useRef(null),T=l.useRef(""),X=b.viewport,_=s.content-s.viewport,L=C(i),N=C(u),D=U(f,10);function H(p){if(j.current){const g=p.clientX-j.current.left,y=p.clientY-j.current.top;m({x:g,y})}}return l.useEffect(()=>{const p=g=>{const y=g.target;(x==null?void 0:x.contains(y))&&L(g,_)};return document.addEventListener("wheel",p,{passive:!1}),()=>document.removeEventListener("wheel",p,{passive:!1})},[X,x,_,L]),l.useEffect(N,[s,N]),E(x,D),E(b.content,D),r.jsx(Ue,{scope:t,scrollbar:x,hasThumb:n,onThumbChange:C(c),onThumbPointerUp:C(a),onThumbPositionChange:N,onThumbPointerDown:C(d),children:r.jsx(A.div,{...h,ref:k,style:{position:"absolute",...h.style},onPointerDown:P(e.onPointerDown,p=>{p.button===0&&(p.target.setPointerCapture(p.pointerId),j.current=x.getBoundingClientRect(),T.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",b.viewport&&(b.viewport.style.scrollBehavior="auto"),H(p))}),onPointerMove:P(e.onPointerMove,H),onPointerUp:P(e.onPointerUp,p=>{const g=p.target;g.hasPointerCapture(p.pointerId)&&g.releasePointerCapture(p.pointerId),document.body.style.webkitUserSelect=T.current,b.viewport&&(b.viewport.style.scrollBehavior=""),j.current=null})})})}),W="ScrollAreaThumb",he=l.forwardRef((e,o)=>{const{forceMount:t,...s}=e,n=ue(W,e.__scopeScrollArea);return r.jsx(z,{present:t||n.hasThumb,children:r.jsx(ke,{ref:o,...s})})}),ke=l.forwardRef((e,o)=>{const{__scopeScrollArea:t,style:s,...n}=e,c=v(W,t),a=ue(W,t),{onThumbPositionChange:d}=a,u=R(o,f=>a.onThumbChange(f)),m=l.useRef(void 0),i=U(()=>{m.current&&(m.current(),m.current=void 0)},100);return l.useEffect(()=>{const f=c.viewport;if(f){const h=()=>{if(i(),!m.current){const b=Be(f,d);m.current=b,d()}};return d(),f.addEventListener("scroll",h),()=>f.removeEventListener("scroll",h)}},[c.viewport,i,d]),r.jsx(A.div,{"data-state":a.hasThumb?"visible":"hidden",...n,ref:u,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...s},onPointerDownCapture:P(e.onPointerDownCapture,f=>{const b=f.target.getBoundingClientRect(),x=f.clientX-b.left,w=f.clientY-b.top;a.onThumbPointerDown({x,y:w})}),onPointerUp:P(e.onPointerUp,a.onThumbPointerUp)})});he.displayName=W;var q="ScrollAreaCorner",me=l.forwardRef((e,o)=>{const t=v(q,e.__scopeScrollArea),s=!!(t.scrollbarX&&t.scrollbarY);return t.type!=="scroll"&&s?r.jsx(Xe,{...e,ref:o}):null});me.displayName=q;var Xe=l.forwardRef((e,o)=>{const{__scopeScrollArea:t,...s}=e,n=v(q,t),[c,a]=l.useState(0),[d,u]=l.useState(0),m=!!(c&&d);return E(n.scrollbarX,()=>{var f;const i=((f=n.scrollbarX)==null?void 0:f.offsetHeight)||0;n.onCornerHeightChange(i),u(i)}),E(n.scrollbarY,()=>{var f;const i=((f=n.scrollbarY)==null?void 0:f.offsetWidth)||0;n.onCornerWidthChange(i),a(i)}),m?r.jsx(A.div,{...s,ref:o,style:{width:c,height:d,position:"absolute",right:n.dir==="ltr"?0:void 0,left:n.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function I(e){return e?parseInt(e,10):0}function be(e,o){const t=e/o;return isNaN(t)?0:t}function O(e){const o=be(e.viewport,e.content),t=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,s=(e.scrollbar.size-t)*o;return Math.max(s,18)}function Ye(e,o,t,s="ltr"){const n=O(t),c=n/2,a=o||c,d=n-a,u=t.scrollbar.paddingStart+a,m=t.scrollbar.size-t.scrollbar.paddingEnd-d,i=t.content-t.viewport,f=s==="ltr"?[0,i]:[i*-1,0];return pe([u,m],f)(e)}function Z(e,o,t="ltr"){const s=O(o),n=o.scrollbar.paddingStart+o.scrollbar.paddingEnd,c=o.scrollbar.size-n,a=o.content-o.viewport,d=c-s,u=t==="ltr"?[0,a]:[a*-1,0],m=Ne(e,u);return pe([0,a],[0,d])(m)}function pe(e,o){return t=>{if(e[0]===e[1]||o[0]===o[1])return o[0];const s=(o[1]-o[0])/(e[1]-e[0]);return o[0]+s*(t-e[0])}}function xe(e,o){return e>0&&e<o}var Be=(e,o=()=>{})=>{let t={left:e.scrollLeft,top:e.scrollTop},s=0;return(function n(){const c={left:e.scrollLeft,top:e.scrollTop},a=t.left!==c.left,d=t.top!==c.top;(a||d)&&o(),t=c,s=window.requestAnimationFrame(n)})(),()=>window.cancelAnimationFrame(s)};function U(e,o){const t=C(e),s=l.useRef(0);return l.useEffect(()=>()=>window.clearTimeout(s.current),[]),l.useCallback(()=>{window.clearTimeout(s.current),s.current=window.setTimeout(t,o)},[t,o])}function E(e,o){const t=C(o);Ee(()=>{let s=0;if(e){const n=new ResizeObserver(()=>{cancelAnimationFrame(s),s=window.requestAnimationFrame(t)});return n.observe(e),()=>{window.cancelAnimationFrame(s),n.unobserve(e)}}},[e,t])}var ve=ae,Fe=ie,Ve=me;const ge=l.forwardRef(({className:e,children:o,...t},s)=>r.jsxs(ve,{ref:s,className:M("relative overflow-hidden",e),...t,children:[r.jsx(Fe,{className:"h-full w-full rounded-[inherit]",children:o}),r.jsx(Se,{}),r.jsx(Ve,{})]}));ge.displayName=ve.displayName;const Se=l.forwardRef(({className:e,orientation:o="vertical",...t},s)=>r.jsx(F,{ref:s,orientation:o,className:M("flex touch-none select-none transition-colors",o==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",o==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...t,children:r.jsx(he,{className:"relative flex-1 rounded-full bg-border"})}));Se.displayName=F.displayName;function qe({conversationId:e,otherUser:o}){const[t,s]=l.useState(""),[n,c]=l.useState(null),a=l.useRef(null),{data:d,isLoading:u}=Te(e),m=_e();l.useEffect(()=>{ee.auth.getUser().then(({data:f})=>{var h;c(((h=f.user)==null?void 0:h.id)||null)})},[]),l.useEffect(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)},[d]);const i=async f=>{if(f.preventDefault(),!t.trim())return;const h=["porra","caralho","merda","bosta","puta","viado","corno","buceta","cu","foder","carai","foda"],b=t.toLowerCase();if(h.some(w=>b.includes(w))){K.error("Mensagem bloqueada",{description:"Sua mensagem contém palavras inadequadas e não foi enviada."});return}try{await m.mutateAsync({conversationId:e,content:t.trim()}),s("")}catch(w){console.error("Error sending message:",w),K.error("Erro",{description:"Não foi possível enviar a mensagem."})}};return u?r.jsx("div",{className:"flex h-full items-center justify-center",children:r.jsx(Y,{className:"h-8 w-8 animate-spin text-muted-foreground"})}):r.jsxs("div",{className:"flex h-full flex-col",children:[r.jsx("div",{className:"p-4 border-b flex items-center justify-between bg-white dark:bg-slate-800",children:r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs(re,{children:[r.jsx(te,{src:o.avatar_url||void 0}),r.jsx(oe,{children:o.name.charAt(0)})]}),r.jsx("div",{children:r.jsx("h3",{className:"font-semibold",children:o.name})})]})}),r.jsx("div",{ref:a,className:"flex-1 overflow-y-auto p-4 space-y-4 bg-slate-50 dark:bg-slate-900",children:d==null?void 0:d.map(f=>{const h=f.sender_id===n;return r.jsxs("div",{className:M("flex flex-col max-w-[70%]",h?"ml-auto items-end":"items-start"),children:[r.jsx("div",{className:M("p-3 rounded-2xl",h?"bg-primary text-white rounded-tr-none":"bg-white dark:bg-slate-800 border rounded-tl-none"),children:r.jsx("p",{children:f.content})}),r.jsx("span",{className:"text-[10px] text-gray-500 mt-1",children:ne(new Date(f.created_at),"HH:mm",{locale:se})})]},f.id)})}),r.jsxs("div",{className:"border-t p-4 space-y-2 bg-white dark:bg-slate-800",children:[r.jsxs("form",{onSubmit:i,className:"flex gap-2",children:[r.jsx(Ae,{value:t,onChange:f=>s(f.target.value),placeholder:"Digite sua mensagem...",className:"flex-1"}),r.jsx(Re,{type:"submit",size:"icon",disabled:!t.trim()||m.isPending,children:m.isPending?r.jsx(Y,{className:"h-4 w-4 animate-spin"}):r.jsx(De,{className:"h-4 w-4"})})]}),r.jsx("p",{className:"text-xs text-center text-muted-foreground",children:"Linguagem ofensiva não é permitida."})]})]})}function nr(){const[e]=we(),o=je(),[t,s]=l.useState(e.get("conversa")),[n,c]=l.useState(null),{data:a,isLoading:d}=Le();l.useEffect(()=>{ee.auth.getUser().then(({data:i})=>{if(!i.user){o("/login");return}c(i.user.id)})},[o]);const u=a==null?void 0:a.find(i=>i.id===t),m=i=>n?i.student_id===n?i.instructor||{name:"Instrutor",avatar_url:null}:i.student||{name:"Aluno",avatar_url:null}:{name:"",avatar_url:null};return d||!n?r.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[r.jsx($,{}),r.jsx("main",{className:"flex-1 flex items-center justify-center",children:r.jsx(Y,{className:"h-8 w-8 animate-spin text-muted-foreground"})}),r.jsx(J,{})]}):r.jsxs(r.Fragment,{children:[r.jsxs(Ce,{children:[r.jsx("title",{children:"Mensagens | Instrutores na Direção"}),r.jsx("meta",{name:"description",content:"Suas conversas com instrutores e alunos"})]}),r.jsxs("div",{className:"min-h-screen flex flex-col bg-background",children:[r.jsx($,{}),r.jsxs("main",{className:"flex-1 container mx-auto px-4 py-8",children:[r.jsx("h1",{className:"text-2xl font-bold mb-6",children:"Mensagens"}),r.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 h-[calc(100vh-16rem)]",children:[r.jsx(G,{className:"md:col-span-1 overflow-hidden",children:r.jsx(ge,{className:"h-full",children:a&&a.length>0?r.jsx("div",{className:"divide-y",children:a.map(i=>{var h;const f=m(i);return r.jsxs("button",{onClick:()=>s(i.id),className:`w-full p-4 flex items-center gap-3 hover:bg-muted/50 transition-colors text-left ${t===i.id?"bg-muted":""}`,children:[r.jsxs(re,{children:[r.jsx(te,{src:f.avatar_url||void 0}),r.jsx(oe,{children:((h=f.name)==null?void 0:h.charAt(0))||"?"})]}),r.jsxs("div",{className:"flex-1 min-w-0",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("p",{className:"font-medium truncate",children:f.name}),i.hasUnread&&r.jsx("span",{className:"h-2 w-2 rounded-full bg-red-500 animate-pulse"})]}),r.jsx("p",{className:"text-sm text-muted-foreground",children:ne(new Date(i.last_message_at||i.created_at),"d MMM",{locale:se})})]})]},i.id)})}):r.jsxs("div",{className:"flex flex-col items-center justify-center h-full p-6 text-center",children:[r.jsx(Q,{className:"h-12 w-12 text-muted-foreground mb-4"}),r.jsx("p",{className:"text-muted-foreground",children:"Nenhuma conversa ainda"})]})})}),r.jsx(G,{className:"md:col-span-2 overflow-hidden",children:t&&u?r.jsx(qe,{conversationId:t,otherUser:m(u)}):r.jsxs("div",{className:"flex flex-col items-center justify-center h-full text-center p-6",children:[r.jsx(Q,{className:"h-16 w-16 text-muted-foreground mb-4"}),r.jsx("h3",{className:"text-lg font-medium mb-2",children:"Selecione uma conversa"}),r.jsx("p",{className:"text-muted-foreground",children:"Escolha uma conversa na lista ao lado para começar a conversar"})]})})]})]}),r.jsx(J,{})]})]})}export{nr as default};
